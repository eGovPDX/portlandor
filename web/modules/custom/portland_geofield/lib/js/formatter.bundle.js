webpackJsonp([2],{"/KFX":function(e,t,n){"use strict";var a=n("Dd8w"),s=n.n(a),r=n("NYxO"),i=n("M4fF"),o={name:"Search",data:function(){return{searchValue:""}},computed:s()({},Object(r.d)(["error"])),methods:s()({update:i.debounce(function(e){this.searchValue&&this.suggest(this.searchValue)},1e3),cancelEdit:function(e){this.searchValue=""}},Object(r.b)(["suggest"]))},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"addressSearchBar"}},[n("div",{staticClass:"input-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchValue,expression:"searchValue"}],staticClass:"form-control",attrs:{type:"text",id:"addressSearch",placeholder:"Search for a location..."},domProps:{value:e.searchValue},on:{keypress:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?(t.preventDefault(),t.stopPropagation(),e.update(t)):null},keyup:function(t){return"button"in t||!e._k(t.keyCode,"esc",27,t.key,"Escape")?e.cancelEdit(t):null},input:function(t){t.target.composing||(e.searchValue=t.target.value)}}}),e._v(" "),n("span",{staticClass:"input-group-btn"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.update}},[e._v("Search")])])])])},staticRenderFns:[]};var l=n("VU/8")(o,c,!1,function(e){n("tUae")},null,null);t.a=l.exports},"0iPh":function(e,t){e.exports=jQuery},1:function(e,t,n){n("j1ja"),e.exports=n("WOzZ")},"3GDu":function(e,t,n){"use strict";var a=n("Dd8w"),s=n.n(a),r=n("d7EF"),i=n.n(r),o=n("NYxO"),c=n("Meid"),l={name:"Map",components:{},created:function(){var e=this;c.loadModules(["esri/Map","esri/views/MapView","esri/widgets/Locate","esri/geometry/Extent"]).then(function(t){var n=i()(t,4),a=n[0],s=n[1],r=n[2],o=n[3],c=new a({basemap:e.settings.basemap||"streets-vector"}),l=(new o(e.extent),new s({container:e.settings.mapid,map:c,zoom:e.settings.zoom.start||10,center:[e.settings.center.lon,e.settings.center.lat]}));if(e.setMapView(l),e.widget){var u=new r({view:l});l.ui.add(u,{position:"top-left"})}if(e.settings.value)for(var d in e.settings.value)if(e.settings.value.hasOwnProperty(d)){var p=e.settings.value[d];e.addWkt(p.wkt)}})},computed:s()({style:function(){return{width:this.settings.width,height:this.settings.height}}},Object(o.d)({widget:"widget",settings:"settings",extent:"extent",value:"value",mapView:function(e){return e.map.mapView}})),methods:s()({},Object(o.b)(["addWkt","setMapView"]))},u={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"portland-geofield-map-app",style:this.style,attrs:{id:this.settings.mapid}},[this._t("default")],2)},staticRenderFns:[]};var d=n("VU/8")(l,u,!1,function(e){n("ikSH")},null,null);t.a=d.exports},Ghpi:function(e,t){},IcnI:function(e,t,n){"use strict";var a=n("7+uW"),s=n("NYxO"),r=n("Meid"),i=n("Zrlr"),o=n.n(i),c=n("wxAW"),l=n.n(c),u=n("mtWM"),d=n.n(u),p=function(){function e(t){o()(this,e),this.apiKey=t}return l()(e,[{key:"suggestAddress",value:function(e,t,n,a){var s=new URLSearchParams;for(var r in s.append("query",e),s.append("api_key",this.apiKey),t)t.hasOwnProperty(r)&&s.append(r,t[r]);return d.a.post("https://www.portlandmaps.com/api/suggest/",s).then(function(t){t.data&&"success"===t.data.status&&t.data.candidates?t.data.candidates[0]?n({location:t.data.candidates[0].location,spatialReference:t.data.spatialReference}):a('Portlandmaps.com could not suggest a location for "'+e+'"'):t.data&&"error"===t.data.status?a("Portlandmaps.com responded with an error."):a("Did not receive a valid response from portlandmaps.com.")}).catch(function(e){a("Portlandmaps.com responded with an error.")})}}]),e}(),f=n("d7EF"),m=n.n(f),h=n("rvVx"),g=n("ellH"),v=n.n(g),y=n("39EV"),w=n.n(y);function b(e){var t,n,a,s,r=0,i=0,o=[];a=e.match(/((\+|\-)[^\+\-]+)/g),s=parseInt(a[0],32);for(var c=1;c<a.length;c+=2)r=t=parseInt(a[c],32)+r,i=n=parseInt(a[c+1],32)+i,o.push([t/s,n/s]);return o}function F(e){return function(e,t){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(e[0],e[e.length-1])||e.push(e[0]),e}function k(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function V(e){for(var t,n=0,a=0,s=e.length,r=e[a];a<s-1;a++)n+=((t=e[a+1])[0]-r[0])*(t[1]+r[1]),r=t;return n>=0}function M(e){var t=[],n=e.slice(0),a=F(n.shift().slice(0));if(a.length>=4){V(a)||a.reverse(),t.push(a);for(var s=0;s<n.length;s++){var r=F(n[s].slice(0));r.length>=4&&(V(r)&&r.reverse(),t.push(r))}}return t}function _(e,t){var n=w.a.Tools.arraysIntersectArrays(e,t),a=w.a.Tools.coordinatesContainPoint(e,t[0]);return!(n||!a)}var x={parse:function e(t,n){var a={};return(n=n||{}).idAttribute=n.idAttribute||void 0,!t.spatialReference||3857!==t.spatialReference.wkid&&102100!==t.spatialReference.wkid||(a.crs=w.a.MercatorCRS),"number"==typeof t.x&&"number"==typeof t.y&&(a.type="Point",a.coordinates=[t.x,t.y],(t.z||t.m)&&a.coordinates.push(t.z),t.m&&a.coordinates.push(t.m)),t.points&&(a.type="MultiPoint",a.coordinates=t.points.slice(0)),t.paths&&(1===t.paths.length?(a.type="LineString",a.coordinates=t.paths[0].slice(0)):(a.type="MultiLineString",a.coordinates=t.paths.slice(0))),t.rings&&(a=function(e){for(var t,n,a,s=[],r=[],i=0;i<e.length;i++){var o=F(e[i].slice(0));if(!(o.length<4))if(V(o)){var c=[o];s.push(c)}else r.push(o)}for(var l=[];r.length;){a=r.pop();var u=!1;for(t=s.length-1;t>=0;t--)if(_(n=s[t][0],a)){s[t].push(a),u=!0;break}u||l.push(a)}for(;l.length;){a=l.pop();var d=!1;for(t=s.length-1;t>=0;t--)if(n=s[t][0],w.a.Tools.arraysIntersectArrays(n,a)){s[t].push(a),d=!0;break}d||s.push([a.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(t.rings.slice(0))),(t.compressedGeometry||t.geometry||t.attributes)&&(a.type="Feature",t.compressedGeometry&&(t.geometry={paths:[b(t.compressedGeometry)]}),a.geometry=t.geometry?e(t.geometry):null,a.properties=t.attributes?k(t.attributes):null,t.attributes&&(a.id=t.attributes[n.idAttribute]||t.attributes.OBJECTID||t.attributes.FID)),new w.a.Primitive(a)},convert:function e(t,n){var a,s=(n=n||{}).idAttribute||"OBJECTID";a=n.sr?{wkid:n.sr}:t&&t.crs&&"urn:ogc:def:crs:OGC:1.3:CRS84"!=t.crs.properties.name?null:{wkid:4326};var r,i={};switch(t.type){case"Point":i.type="point",i.x=t.coordinates[0],i.y=t.coordinates[1],t.coordinates[2]&&(i.z=t.coordinates[2]),t.coordinates[3]&&(i.m=t.coordinates[3]),i.spatialReference=a;break;case"MultiPoint":i.type="multipoint",i.points=t.coordinates.slice(0),i.spatialReference=a;break;case"LineString":i.type="polyline",i.paths=[t.coordinates.slice(0)],i.spatialReference=a;break;case"MultiLineString":i.type="polyline",i.paths=t.coordinates.slice(0),i.spatialReference=a;break;case"Polygon":i.type="polygon",i.rings=M(t.coordinates.slice(0)),i.spatialReference=a;break;case"MultiPolygon":i.rings=function(e){for(var t=[],n=0;n<e.length;n++)for(var a=M(e[n]),s=a.length-1;s>=0;s--){var r=a[s].slice(0);t.push(r)}return t}(t.coordinates.slice(0)),i.spatialReference=a;break;case"Feature":t.geometry&&(i.geometry=e(t.geometry,n)),i.attributes=t.properties?k(t.properties):{},t.id&&(i.attributes[s]=t.id);break;case"FeatureCollection":for(i=[],r=0;r<t.features.length;r++)i.push(e(t.features[r],n));break;case"GeometryCollection":for(i=[],r=0;r<t.geometries.length;r++)i.push(e(t.geometries[r],n))}return i},parseCompressedGeometry:function(e){return new w.a.LineString(b(e))}},E=function(e){if(e){var t=v.a.parse(e);return x.convert(t)}},O=function(e){if(e){var t=x.parse(e);return v.a.convert(t)}},C={},R={};r.loadModules(["esri/geometry/Point","esri/Graphic"]).then(function(e){var t=m()(e,2),n=t[0],a=t[1];C=n,R=a});var S={state:{mapView:{},values:[],center:{},zoom:{start:12,focus:16}},getters:{},actions:{setMapView:function(e,t){(0,e.commit)("setMapView",{mapView:t})},addWkt:function(e,t){e.commit;(0,e.dispatch)("addGeometry",E(t))},addGeometry:function(e,t){var n=e.commit,a=e.state,s=new R({geometry:t,symbol:h.a[t.type]});a.mapView.when(function(){n("addGraphic",{graphic:s})}),n("clearActiveButton")},clearGraphics:function(e){(0,e.commit)("clearGraphics")},center:function(e,t){var n=e.commit,a=t.location,s=t.spatialReference;n("center",{point:new C({x:a.x,y:a.y,spatialReference:s})}),n("focus")}},mutations:{setMapView:function(e,t){var n=t.mapView;e.mapView=n},addGraphic:function(e,t){var n=t.graphic;e.mapView.graphics.add(n),e.mapView.goTo({target:n,zoom:e.zoom.focus})},clearGraphics:function(e){e.mapView.graphics.removeAll()},center:function(e,t){var n=t.point;e.mapView.goTo({center:n,zoom:e.zoom.focus})},focus:function(e){e.mapView.zoom=e.zoom.focus}}},D={state:{sketchViewModel:{},activeButton:""},getters:{},actions:{setSketchViewModel:function(e,t){(0,e.commit)("setSketchViewModel",{sketchViewModel:t})},draw:function(e,t){var n=e.commit;e.state,n("setActiveButton",{type:t}),n("clearGraphics"),n("setMessage",{message:{id:"MAP_HELP",text:"point"===t?"Drawing started... Click to place a point.":'Drawing started... Double-click or press "c" to end drawing.',type:"info"}}),n("startDraw",{type:t})}},mutations:{setSketchViewModel:function(e,t){var n=t.sketchViewModel;e.sketchViewModel=n},startDraw:function(e,t){var n=t.type;e.sketchViewModel.create(n)},setActiveButton:function(e,t){var n=t.type;e.activeButton=n},clearActiveButton:function(e){e.activeButton=""}}},A=new p("4F82E619ACB509A261A1D3E9C146E190"),G={state:{},getters:{},actions:{suggest:function(e,t){var n=e.commit,a=e.dispatch;n("clearMessages"),A.suggestAddress(t,{},function(e){a("center",{location:e.location,spatialReference:e.spatialReference})},function(e){n("setMessage",{message:{id:"PORTLANDMAPS_REQUEST_ERROR",text:e,type:"danger"}})})}},mutations:{}},P=n("mvHQ"),B=n.n(P),j=function(){function e(){o()(this,e)}return l()(e,[{key:"getAddress",value:function(e,t){var n="https://www.portlandmaps.com/arcgis/rest/services/Public/Address_Geocoding_PDX/GeocodeServer/reverseGeocode?location="+t+","+e+"&f=json";return d.a.get(encodeURI(n))}},{key:"geocodeAddress",value:function(e){var t={records:[{attributes:{OBJECTID:1,Street:e.street,City:e.city,State:e.state,Zip:e.zip}}]},n=GEOCODE_ADDRESS_URL+"?addresses="+B()(t)+"&f=json";return d.a.get(encodeURI(n))}}]),e}(),z=n("0iPh"),U=n.n(z),I={Street:"address-line1",City:"locality",State:"administrative-area",ZIP:"postal-code"},T={OREGON:"OR"},L=function(){function e(t){var n=this;o()(this,e);var a=".field--type-address.field--name-"+t.replace(/_/g,"-");this.addressField=U()(a),this.address={},U()(document).ajaxComplete(function(e,a,s){s.extraData&&s.extraData._drupal_ajax&&s.extraData._triggering_element_name===t+"[0][address][country_code]"&&n.fillFields()})}return l()(e,[{key:"fillFields",value:function(){for(var e in I)if(I.hasOwnProperty(e)){var t=I[e];"State"===e&&(this.address[e]=T[this.address[e]]||this.address[e]),this.addressField.find("."+t).val(this.address[e]).change()}}},{key:"set",value:function(e){this.address=e,this.addressField.find(".country.form-select").length?this.addressField.find(".country.form-select").val("US").trigger("change"):this.fillFields()}}]),e}(),N=function(){function e(t){o()(this,e),this.valueField=document.getElementById(t)}return l()(e,[{key:"set",value:function(e){this.valueField.value=O(e)}},{key:"clear",value:function(){this.valueField.value=NULL}},{key:"get",value:function(){return this.valueField.value}}]),e}(),W={state:{addressField:"field_facility_address",valueField:"edit-field-geometry-0-value-wkt"},getters:{},actions:{setAddressField:function(e,t){var n=e.commit,a=(e.state,e.dispatch);(new j).getAddress(t.y,t.x).then(function(e){!e||e.data.error?a("setMessage",{id:"GEOCODESERVER_GEOCODE_ERROR",text:"Unable to geocode an address for the geometry.",type:"danger"}):e.data.address&&n("setAddressField",{address:e.data.address})})},setValueField:function(e,t){var n=e.commit;e.state,e.dispatch;n("setValueField",{geometry:t})}},mutations:{setAddressField:function(e,t){var n=t.address;new L(e.addressField).set(n)},clearValueField:function(e){new N(e.valueField).clear()},setValueField:function(e,t){var n=t.geometry;new N(e.valueField).set(n)}}};a.a.use(s.a);new p("28D3F96A84990C0554495C07309117EF"),t.a=new s.a.Store({modules:{map:S,drawbar:D,search:G,field:W},state:{messages:[],widget:!1,settings:{wktid:"",mapid:"",width:"100%",height:"50vh",center:{lon:-13656529.895,lat:5703070.921},zoom:{start:12,focus:16},value:{}}},getters:{mapid:function(e){return e.settings.mapid+"-app"}},actions:{initialize:function(){},setMessage:function(e,t){(0,e.commit)("setMessage",{message:t})},clearMessages:function(e){(0,e.commit)("clearMessages")}},mutations:{setMessage:function(e,t){var n=t.message;e.messages=[n]},clearMessages:function(e){e.messages=[]}}})},Ty8c:function(e,t,n){"use strict";var a=n("Dd8w"),s=n.n(a),r=n("d7EF"),i=n.n(r),o=n("NYxO"),c=n("Meid"),l={point:"esri-icon-blank-map-pin",multipoint:"esri-icon-handle-horizontal",line:"",polyline:"esri-icon-polyline",polygon:"esri-icon-polygon"},u={name:"DrawButton",props:["type"],computed:s()({icon:function(){return l[this.type]},title:function(){return"Draw "+this.type},active:function(){return this.type===this.activeButton}},Object(o.d)({activeButton:function(e){return e.drawbar.activeButton}})),methods:s()({},Object(o.b)(["draw"]))},d={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("button",{class:[{"action-button":!0,active:e.active},e.icon,e.type],attrs:{name:e.type,type:"button",title:e.title},on:{click:function(t){e.draw(e.type,t)}}})},staticRenderFns:[]};var p=n("VU/8")(u,d,!1,function(e){n("VOC/")},null,null).exports,f=n("rvVx"),m={name:"Drawbar",components:{DrawButton:p},created:function(){var e=this;c.loadModules(["esri/widgets/Sketch/SketchViewModel"]).then(function(t){var n=new(0,i()(t,1)[0])({view:e.mapView,pointSymbol:f.a.point,polylineSymbol:f.a.polyline,polygonSymbol:f.a.polygon});n.on("draw-complete",function(t){e.clearMessages();var n=t.geometry;e.addGeometry(n);var a={};a=n.extent?{x:n.extent.center.x,y:n.extent.center.y}:{x:n.x,y:n.y},e.setAddressField(a),c.loadModules(["esri/geometry/support/webMercatorUtils"]).then(function(t){var a=i()(t,1)[0];e.setValueField(a.webMercatorToGeographic(n))})}),e.setSketchViewModel(n)})},computed:s()({},Object(o.d)({sketchViewModel:function(e){return e.drawbar.sketchViewModel},mapView:function(e){return e.map.mapView}})),methods:s()({},Object(o.b)(["clearGraphics","setSketchViewModel","addGeometry","setAddressField","setValueField","clearMessages"]))},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topbar"},[t("DrawButton",{attrs:{type:"point"}}),this._v(" "),t("DrawButton",{attrs:{type:"multipoint"}}),this._v(" "),t("DrawButton",{attrs:{type:"polyline"}}),this._v(" "),t("DrawButton",{attrs:{type:"polygon"}}),this._v(" "),t("button",{staticClass:"action-button esri-icon-trash reset",attrs:{name:"reset",type:"button",title:"Clear graphics"},on:{click:this.clearGraphics}})],1)},staticRenderFns:[]};var g=n("VU/8")(m,h,!1,function(e){n("Ghpi")},null,null);t.a=g.exports},"VOC/":function(e,t){},WOzZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),s=n("Dd8w"),r=n.n(s),i=n("NYxO"),o=n("3GDu"),c=(n("mqSb"),n("Ty8c"),n("/KFX"),{name:"Formatter",components:{Map:o.a},computed:r()({},Object(i.c)(["mapid"])),methods:{}}),l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:this.mapid}},[t("Map")],1)},staticRenderFns:[]};var u=n("VU/8")(c,l,!1,function(e){n("ji5e")},null,null).exports,d=n("IcnI");!function(e,t,n){t.behaviors.esri={attach:function(t,n){n.portland_geofield_map&&e(t).find(".portland-geofield-map").once("portland_processed").each(function(t,s){var r=e(s).attr("id"),i=n.portland_geofield_map[r];new a.a({el:"#"+r,store:d.a,components:{Formatter:u},template:"<Formatter/>"});d.a.state.settings=i})}}}(jQuery,Drupal,drupalSettings)},fCOT:function(e,t){},ikSH:function(e,t){},ji5e:function(e,t){},mqSb:function(e,t,n){"use strict";var a=n("Dd8w"),s=n.n(a),r=n("NYxO"),i={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{class:[this.alertClass,this.typeClass],attrs:{role:"alert"}},[this._v("\n  "+this._s(this.message)+"\n")])},staticRenderFns:[]};var o={name:"Messages",components:{Message:n("VU/8")({name:"Message",props:["message","type"],data:function(){return{alertClass:"alert"}},computed:{typeClass:function(){return"alert-"+this.type}}},i,!1,function(e){n("tCnw")},null,null).exports},computed:s()({},Object(r.d)(["messages"]))},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"messages"}},this._l(this.messages,function(e){return t("Message",{key:e.id,attrs:{message:e.text,type:e.type}})}))},staticRenderFns:[]};var l=n("VU/8")(o,c,!1,function(e){n("fCOT")},null,null);t.a=l.exports},rvVx:function(e,t,n){"use strict";t.a={point:{type:"simple-marker",color:"#8A2BE2",size:"14px",outline:{color:"#FFFFFF",width:3}},multipoint:{type:"simple-marker",color:"#8A2BE2",size:"14px",outline:{color:"#FFFFFF",width:3}},polyline:{type:"simple-line",color:"#8A2BE2",width:3},polygon:{type:"simple-fill",color:"#FFFFFF",style:"solid",outline:{color:"#8A2BE2",width:2}}}},tCnw:function(e,t){},tUae:function(e,t){}},[1]);