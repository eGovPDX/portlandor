uuid: 35ad0145-13c1-463e-8cec-8126f22ac636
langcode: en
status: open
dependencies:
  module:
    - portland_smartsheet
weight: 0
open: null
close: null
uid: 221
template: false
archive: false
id: register_yard_tree
title: 'Register for the Yard Tree Giveaway'
description: ''
categories: {  }
elements: |-
  section_assistance:
    '#type': webform_section
    '#title': 'Need Some Help?'
    apply_needs_help:
      '#type': radios
      '#title': 'Would you like an Urban Forestry staff member to call you and answer questions about which trees to get or where to plant them in your yard? Choose the trees you prefer, and we can make changes during your phone consultation.'
      '#options':
        'No': "No, I don't need help"
        'Yes': 'Yes, I do need help and would like to receive a phone call'
      '#required': true
    markup_post_submission:
      '#type': webform_markup
      '#states':
        visible:
          ':input[name="apply_needs_help"]':
            value: 'Yes'
      '#markup': '<div class="alert alert--info next-steps"><h2 class="mt-0">Next Steps</h2><p class="mb-0">Following the completion of this form, you will receive an email from "City of Portland via Smartsheet" to schedule a time and date for your phone consultation. We will also provide the link in your confirmation email.</p></div>'
  section_tree_selection:
    '#type': webform_section
    '#title': 'Select Your Trees'
    apply_tree_1:
      '#type': select
      '#title': 'Tree #1'
      '#options':
        'Beech, European': 'Beech, European'
        "Birch, river 'Heritage'": "Birch, river 'Heritage'"
        'Colossal chestnut and Marrone Di val di chestnut': 'Colossal chestnut and Marrone Di val di chestnut'
        "Cypress, Arizona 'Blue Ice'": "Cypress, Arizona 'Blue Ice'"
        Douglas-fir: Douglas-fir
        'Filbert, Turkish': 'Filbert, Turkish'
        'Hemlock, western': 'Hemlock, western'
        'Hornbeam, European': 'Hornbeam, European'
        Incense-cedar: Incense-cedar
        Katsura: Katsura
        "Linden, silver 'Sterling'": "Linden, silver 'Sterling'"
        'Oak, interior live': 'Oak, interior live'
        'Oak, Oregon white': 'Oak, Oregon white'
        'Oak, Swamp white': 'Oak, Swamp white'
        'Pine, shore': 'Pine, shore'
        'Pine, Western white': 'Pine, Western white'
        'Pine, Willamette Valley ponderosa': 'Pine, Willamette Valley ponderosa'
        "Planetree, London 'Exclamation!'": "Planetree, London 'Exclamation!'"
        "Redwood, coast 'Soquel'": "Redwood, coast 'Soquel'"
        'Redwood, dawn': 'Redwood, dawn'
        'Sequoia, giant': 'Sequoia, giant'
        "Walnut, English 'Manregion'": "Walnut, English 'Manregion'"
        "Zelkova, Japanese 'Green Vase'": "Zelkova, Japanese 'Green Vase'"
      '#required': true
      '#states':
        disabled:
          ':input[name="apply_tree_2"]':
            value: 'Colossal chestnut and Marrone Di val di chestnut'
    apply_tree_2:
      '#type': select
      '#title': 'Tree #2'
      '#options':
        'Beech, European': 'Beech, European'
        "Birch, river 'Heritage'": "Birch, river 'Heritage'"
        'Colossal chestnut and Marrone Di val di chestnut': 'Colossal chestnut and Marrone Di val di chestnut'
        "Cypress, Arizona 'Blue Ice'": "Cypress, Arizona 'Blue Ice'"
        Douglas-fir: Douglas-fir
        'Filbert, Turkish': 'Filbert, Turkish'
        'Hemlock, western': 'Hemlock, western'
        'Hornbeam, European': 'Hornbeam, European'
        Incense-cedar: Incense-cedar
        Katsura: Katsura
        "Linden, silver 'Sterling'": "Linden, silver 'Sterling'"
        'Oak, interior live': 'Oak, interior live'
        'Oak, Oregon white': 'Oak, Oregon white'
        'Oak, Swamp white': 'Oak, Swamp white'
        'Pine, shore': 'Pine, shore'
        'Pine, Western white': 'Pine, Western white'
        'Pine, Willamette Valley ponderosa': 'Pine, Willamette Valley ponderosa'
        "Planetree, London 'Exclamation!'": "Planetree, London 'Exclamation!'"
        "Redwood, coast 'Soquel'": "Redwood, coast 'Soquel'"
        'Redwood, dawn': 'Redwood, dawn'
        'Sequoia, giant': 'Sequoia, giant'
        "Walnut, English 'Manregion'": "Walnut, English 'Manregion'"
        "Zelkova, Japanese 'Green Vase'": "Zelkova, Japanese 'Green Vase'"
      '#states':
        disabled:
          - ':input[name="apply_tree_1"]':
              value: 'Colossal chestnut and Marrone Di val di chestnut'
    markup_chestnut_disclaimer:
      '#type': webform_markup
      '#states':
        visible:
          - ':input[name="apply_tree_1"]':
              value: 'Colossal chestnut and Marrone Di val di chestnut'
          - or
          - ':input[name="apply_tree_2"]':
              value: 'Colossal chestnut and Marrone Di val di chestnut'
      '#markup': '<div class="alert alert--info next-steps"><h2 class="mt-0">Chestnut Disclaimer</h2><p class="mb-0">By selecting the chestnut, you are committing to taking two trees. Both chestnuts need to be taken in order to bear fruit.</p></div>'
  section_tree_planting_location:
    '#type': webform_section
    '#title': 'Tree Planting Location'
    apply_location:
      '#type': portland_location_picker
      '#title': 'Tree Planting Location'
      '#description': '<p>Use the map to select the location where the trees will be planted.</p>'
      '#description_display': before
      '#location_search__description': |
        Search the for an address or use the map to click a location.
      '#place_name__access': false
      '#location_details__access': false
  section_contact:
    '#type': webform_section
    '#title': 'Your Contact Information'
    contact_name:
      '#type': textfield
      '#title': Name
      '#required': true
    contact_email:
      '#type': textfield
      '#title': Email
      '#required': true
      '#pattern': '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
      '#pattern_error': 'Please enter a correctly formatted email address, such as myname@example.com.'
    contact_phone:
      '#type': textfield
      '#title': Phone
      '#required': true
      '#input_mask': '(999) 999-9999'
    contact_mailing_address:
      '#type': portland_address_verifier
      '#title': 'Mailing Address'
      '#location_address__title': 'Mailing Address'
css: ''
javascript: |
  (() => {
    Drupal.behaviors.treeInventoryCheck = {
      attach(context) {
        once("treeInventoryCheck", ".webform-submission-form", context).forEach(
          (form) => {
            const treeSelect1 = form.querySelector('select[name="apply_tree_1"]');
            const treeSelect2 = form.querySelector('select[name="apply_tree_2"]');
            const treeSelect3 = form.querySelector('select[name="apply_tree_3"]');

            if (treeSelect1 && treeSelect2 && treeSelect3) {
              fetch("/api/smartsheet/uf-tree-inventory")
                .then((res) => {
                  if (!res.ok) {
                    throw new Error("Response not OK");
                  }

                  return res.json();
                })
                .then((data) => {
                  const speciesInventory = data.filter(
                    (item) => item.type === "Species"
                  );

                  // Create a map of tree name -> remaining qty
                  const inventoryMap = speciesInventory.reduce((acc, item) => {
                    acc[item.name_en] = parseInt(item.remaining_qty, 10);
                    return acc;
                  }, {});

                  [...treeSelect1.options, ...treeSelect2.options, ...treeSelect3.options].forEach(
                    (option) => {
                      const optionValue = option.value;
                      const optionText = option.textContent;
                      if (!optionValue || !optionText) return;

                      if (inventoryMap[optionValue] !== undefined) {
                        const remainingQty = inventoryMap[optionValue];

                        if (remainingQty <= 0) {
                          option.disabled = true;
                          option.textContent = `${optionText} (Out of stock)`;
                        } else {
                          option.textContent = `${optionText} (${remainingQty} remaining)`;
                        }
                      }
                    }
                  );
                })
                .catch((error) => {
                  console.error("Error fetching tree inventory:", error);
                });
            }
          }
        );
      },
    };
  })();
settings:
  ajax: false
  ajax_scroll_top: form
  ajax_progress_type: ''
  ajax_effect: ''
  ajax_speed: null
  page: true
  page_submit_path: ''
  page_confirm_path: ''
  page_theme_name: ''
  form_title: both
  form_submit_once: false
  form_open_message: ''
  form_close_message: ''
  form_exception_message: ''
  form_previous_submissions: true
  form_confidential: false
  form_confidential_message: ''
  form_disable_remote_addr: false
  form_convert_anonymous: false
  form_prepopulate: false
  form_prepopulate_source_entity: false
  form_prepopulate_source_entity_required: false
  form_prepopulate_source_entity_type: ''
  form_unsaved: false
  form_disable_back: false
  form_submit_back: false
  form_disable_autocomplete: false
  form_novalidate: false
  form_disable_inline_errors: false
  form_required: false
  form_autofocus: false
  form_details_toggle: false
  form_reset: false
  form_access_denied: default
  form_access_denied_title: ''
  form_access_denied_message: ''
  form_access_denied_attributes: {  }
  form_file_limit: ''
  form_attributes: {  }
  form_method: ''
  form_action: ''
  share: false
  share_node: false
  share_theme_name: ''
  share_title: true
  share_page_body_attributes: {  }
  submission_label: ''
  submission_exception_message: ''
  submission_locked_message: ''
  submission_log: false
  submission_excluded_elements: {  }
  submission_exclude_empty: false
  submission_exclude_empty_checkbox: false
  submission_views: {  }
  submission_views_replace: {  }
  submission_user_columns: {  }
  submission_user_duplicate: false
  submission_access_denied: default
  submission_access_denied_title: ''
  submission_access_denied_message: ''
  submission_access_denied_attributes: {  }
  previous_submission_message: ''
  previous_submissions_message: ''
  autofill: false
  autofill_message: ''
  autofill_excluded_elements: {  }
  wizard_progress_bar: true
  wizard_progress_pages: false
  wizard_progress_percentage: false
  wizard_progress_link: false
  wizard_progress_states: false
  wizard_start_label: ''
  wizard_preview_link: false
  wizard_confirmation: true
  wizard_confirmation_label: ''
  wizard_auto_forward: true
  wizard_auto_forward_hide_next_button: false
  wizard_keyboard: true
  wizard_track: ''
  wizard_prev_button_label: ''
  wizard_next_button_label: ''
  wizard_toggle: false
  wizard_toggle_show_label: ''
  wizard_toggle_hide_label: ''
  wizard_page_type: container
  wizard_page_title_tag: h2
  preview: 0
  preview_label: ''
  preview_title: ''
  preview_message: ''
  preview_attributes: {  }
  preview_excluded_elements: {  }
  preview_exclude_empty: true
  preview_exclude_empty_checkbox: false
  draft: none
  draft_multiple: false
  draft_auto_save: false
  draft_saved_message: ''
  draft_loaded_message: ''
  draft_pending_single_message: ''
  draft_pending_multiple_message: ''
  confirmation_type: page
  confirmation_url: ''
  confirmation_title: ''
  confirmation_message: ''
  confirmation_attributes: {  }
  confirmation_back: true
  confirmation_back_label: ''
  confirmation_back_attributes: {  }
  confirmation_exclude_query: false
  confirmation_exclude_token: false
  confirmation_update: false
  limit_total: null
  limit_total_interval: null
  limit_total_message: ''
  limit_total_unique: false
  limit_user: null
  limit_user_interval: null
  limit_user_message: ''
  limit_user_unique: false
  entity_limit_total: null
  entity_limit_total_interval: null
  entity_limit_user: null
  entity_limit_user_interval: null
  purge: none
  purge_days: null
  results_disabled: false
  results_disabled_ignore: false
  results_customize: false
  token_view: false
  token_update: false
  token_delete: false
  serial_disabled: false
access:
  create:
    roles:
      - anonymous
      - authenticated
    users: {  }
    permissions: {  }
  view_any:
    roles: {  }
    users: {  }
    permissions: {  }
  update_any:
    roles: {  }
    users: {  }
    permissions: {  }
  delete_any:
    roles: {  }
    users: {  }
    permissions: {  }
  purge_any:
    roles: {  }
    users: {  }
    permissions: {  }
  view_own:
    roles: {  }
    users: {  }
    permissions: {  }
  update_own:
    roles: {  }
    users: {  }
    permissions: {  }
  delete_own:
    roles: {  }
    users: {  }
    permissions: {  }
  administer:
    roles: {  }
    users: {  }
    permissions: {  }
  test:
    roles: {  }
    users: {  }
    permissions: {  }
  configuration:
    roles: {  }
    users: {  }
    permissions: {  }
handlers:
  smartsheet_add_row_to_existing_sheet:
    id: smartsheet_add_row
    handler_id: smartsheet_add_row_to_existing_sheet
    label: 'Smartsheet: add row to existing sheet'
    notes: ''
    status: true
    conditions: {  }
    weight: 0
    settings:
      column_mappings:
        8577025654869892: _submission_id_
        414251330260868: contact_name
        4917850957631364: contact_email
        2666051143946116: apply_tree_1
        520701826256772: apply_tree_2
      multiple_rows_enable: null
      multiple_rows_field: ''
      multiple_rows_separator: ''
      row_location: toBottom
      sheet_id: '4756744392580'
      upload_attachments: '1'
variants: {  }
