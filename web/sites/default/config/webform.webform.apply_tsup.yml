uuid: 695f4893-8f41-4057-8eb2-9cb64f37899e
langcode: en
status: open
dependencies:
  module:
    - portland
    - portland_zendesk
third_party_settings:
  portland:
    disable_demographic_form_prompt: 1
    exclude_from_json:
      permit_date_unenforceable_agree: permit_date_unenforceable_agree
      friendly_permit_type: friendly_permit_type
      computed_permit_reason: computed_permit_reason
      computed_permit_street_name: computed_permit_street_name
      computed_tags: computed_tags
weight: 0
open: null
close: null
uid: 1
template: false
archive: false
id: apply_tsup
title: 'Apply for a Temporary Street Use Permit'
description: ''
categories: {  }
elements: |-
  page_assessment:
    '#type': webform_wizard_page
    '#title': Assessment
    '#states':
      invisible:
        ':input[name="assessment_prefilled"]':
          '!value': ''
    wizard_permit_need:
      '#type': radios
      '#title': 'What do you need?'
      '#prepopulate': true
      '#options':
        parking: 'I need to use or reserve parking space(s)'
        traffic: 'I need to use or close a traffic lane, bike lane, sidewalk, or full street'
        existing_permit: 'I already have a Temporary Street Use Permit that I want to cancel, change, extend, or renew'
        general: 'I have a general permit question'
      '#options_display': buttons_vertical
      '#required': true
  page_contact_info:
    '#type': webform_wizard_page
    '#title': 'Contact Info'
    '#states':
      invisible:
        ':input[name="wizard_permit_need"]':
          value: general
    contact_full_legal_name:
      '#type': textfield
      '#title': 'Full name'
      '#required': true
    contact_company:
      '#type': textfield
      '#title': 'Company name (if applicable)'
      '#description': |-
        You must either work for this company or be authorized to represent them.<br />
        <br />
        The permit will be issued with this company as the permit holder, and the permit holder is the liable party for any damages<br />
        <br />
        If your permit requires an insurance certificate, the company name on that certificate must exactly match the company name provided on this permit application.<br />
        <br />
        Any refunds of permit fees will be issued to this company name, regardless of payment method.
    contact_phone:
      '#type': textfield
      '#title': 'Best phone number to reach you at'
      '#input_mask': 999-999-9999
      '#required': true
    contact_email:
      '#type': webform_email_confirm
      '#title': 'Email address'
      '#confirm__title': 'Confirm email address'
      '#description': 'Primary communication will be done through email, please check your spam folder.'
      '#description_display': before
      '#required': true
      '#pattern': '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
      '#pattern_error': 'Please enter a correctly formatted email address, such as myname@example.com.'
    contact_applicant_type:
      '#type': radios
      '#title': 'Do any of the below apply to you? (Only if applicable, otherwise leave empty)'
      '#prepopulate': true
      '#options':
        fun: 'I am performing work for a Franchise Utility Company'
        contractor: 'The City of Portland has contracted me for this work'
        bureau: 'This work is being performed by the City of Portland for the City'
        sidewalk_repair: 'I have been directed by MIP to submit a Sidewalk Notification'
        '': 'None of the above'
      '#options_display': buttons_vertical
    contact_fun_company:
      '#type': webform_radios_other
      '#title': 'Which company?'
      '#prepopulate': true
      '#states':
        visible:
          ':input[name="contact_applicant_type"]':
            value: fun
      '#options':
        'Astound Broadband': 'Astound Broadband'
        Comcast: Comcast
        'Crown Castle': 'Crown Castle'
        MCI/Verizon: MCI/Verizon
        'NW Natural': 'NW Natural'
        'Pacific Power': 'Pacific Power'
        PGE: PGE
        Windstream: Windstream
        'Zayo Group': 'Zayo Group'
      '#options_display': buttons_vertical
    contact_bureau:
      '#type': webform_radios_other
      '#title': 'For which bureau are you under contract for this work?'
      '#prepopulate': true
      '#states':
        visible:
          - ':input[name="contact_applicant_type"]':
              value: contractor
          - or
          - ':input[name="contact_applicant_type"]':
              value: bureau
      '#options':
        BES: BES
        BPS: BPS
        PBOT: PBOT
        'PP&R': 'PP&R'
        PWB: PWB
      '#options_display': buttons_vertical
    support_agent_use_only:
      '#type': portland_support_agent_widget
      '#title': 'Support Agent Use Only'
      '#states':
        visible:
          - ':input[name="wizard_permit_need"]':
              value: general
          - or
          - ':input[name="permit_type"]':
              '!value': unknown
      '#wrapper_attributes':
        style: 'background-color: #ccc; padding: 15px;'
      '#access_create_roles':
        - support_agent
        - administrator
  page_existing_permit:
    '#type': webform_wizard_page
    '#title': 'Request Details'
    '#states':
      visible:
        - ':input[name="permit_type"]':
            value: change_request
        - or
        - ':input[name="permit_type"]':
            value: existing_permit
        - or
        - ':input[name="permit_type"]':
            value: renewal_request
    '#admin_title': 'Existing Permit'
    wizard_existing_permit_situation:
      '#type': radios
      '#title': 'What option best describes your situation?'
      '#description': 'I need to...'
      '#description_display': before
      '#prepopulate': true
      '#options':
        change: 'Change or cancel an upcoming permit'
        extend: 'Extend the dates of an ongoing permit, or reissue an expired permit'
      '#options_display': buttons_vertical
      '#required': true
    container_change_request:
      '#type': container
      '#states':
        visible:
          ':input[name="wizard_existing_permit_situation"]':
            value: change
      markup_change_request:
        '#type': webform_markup
        '#markup': |-
          <h2>Submit a change request</h2>
          For upcoming or active permits, please provide the associated permit number.<br />
          <br />
          For recently submitted applications, please provide the application number included in the automated confirmation email received when submitting your application.
      change_request_items_to_change:
        '#type': number
        '#title': 'How many permits do you need to change or cancel?'
        '#min': 1
        '#step': 1
        '#required': true
      change_request_id:
        '#type': textfield
        '#title': 'Identifying Number (Original Application #, Permit #, or IVR #)'
        '#multiple': true
        '#description': 'You may enter multiple numbers if all change details are the same for each permit.'
        '#prepopulate': true
        '#required': true
        '#multiple__no_items_message': ''
        '#multiple__min_items': 1
        '#multiple__sorting': false
        '#multiple__add_more_input': false
        '#multiple__add_more_button_label': 'Add another permit'
      change_request_location:
        '#type': textfield
        '#title': 'What is the location of your permit(s)?'
      change_request_change_type:
        '#type': webform_select_other
        '#title': 'What kind of change are you requesting?'
        '#options':
          Dates: Dates
          'Number of Spaces': 'Number of Spaces'
          Cancel: Cancel
          'Put on Hold': 'Put on Hold'
        '#other__option_label': Other
        '#other__placeholder': 'If other, please specify'
        '#required': true
      change_request_additional_info:
        '#type': textarea
        '#title': 'Describe in detail the changes you would like to make:'
        '#required': true
      change_request_supporting_documents:
        '#type': webform_document_file
        '#title': 'Attach any supporting documents.'
        '#multiple': 8
        '#max_filesize': '30'
        '#file_help': help
        '#file_extensions': 'pdf jpg jpeg png'
      change_request_acknowledge_fee:
        '#type': checkbox
        '#title': 'I understand that a $30.00 change fee may apply. This fee will not apply if this is your first change to this permit.'
        '#required': true
        '#required_error': 'You must acknowledge this.'
    container_renewal_request:
      '#type': container
      '#states':
        visible:
          ':input[name="wizard_existing_permit_situation"]':
            value: extend
      markup_renewal_request:
        '#type': webform_markup
        '#markup': '<h2>Please submit a Renewal Request via the below form</h2>'
      renewal_request_items_to_change:
        '#type': number
        '#title': 'How many permits do you need to renew or reissue?'
        '#min': 1
        '#step': 1
        '#required': true
      renewal_request_id:
        '#type': textfield
        '#title': 'Identifying Number (Original Application #, Permit #, or IVR #)'
        '#multiple': true
        '#description': 'You may enter multiple numbers if all renewal details are the same for each permit.'
        '#prepopulate': true
        '#required': true
        '#multiple__no_items_message': ''
        '#multiple__min_items': 1
        '#multiple__sorting': false
        '#multiple__add_more_input': false
        '#multiple__add_more_button_label': 'Add another permit'
      renewal_request_location:
        '#type': textfield
        '#title': 'What is the location of your permit(s)?'
      renewal_request_permit_date_days_of_week:
        '#type': checkboxes
        '#title': 'New Permit Days of Week'
        '#options':
          monday: Monday
          tuesday: Tuesday
          wednesday: Wednesday
          thursday: Thursday
          friday: Friday
          saturday: Saturday
          sunday: Sunday
        '#required': true
      renewal_request_permit_date_start:
        '#type': date
        '#title': 'New Permit Start Date'
        '#description': |-
          <em>Please account for our 5 business day processing time when picking your start date (10 business days for full street closures).</em><br />
          <br />
          <strong>NOTE:</strong> Please make sure the street you are working on is not restricted by a&nbsp;<a target="_blank" href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-moratorium-dates-and-maps">Moratorium</a>.
        '#required': true
        '#date_date_min': today
      renewal_request_permit_date_end:
        '#type': date
        '#title': 'New Permit End Date'
        '#required': true
        '#date_date_min': today
      renewal_request_additional_info:
        '#type': textarea
        '#title': 'Describe in detail any changes you would like to make:'
        '#placeholder': 'Please describe any changes that you would need from the original permit, i.e. permitted hours/days of week'
      renewal_request_supporting_documents:
        '#type': webform_document_file
        '#title': 'Attach any supporting documents.'
        '#multiple': 8
        '#max_filesize': '30'
        '#file_help': help
        '#file_extensions': 'pdf jpg jpeg png'
      renewal_request_acknowledge_fee:
        '#type': checkbox
        '#title': 'My insurance information is on file or is being submitted (if required).'
        '#description': |-
          If previously required, the City of Portland must have your current insurance information on file before a permit can be renewed.<br />
          <br />
          <strong>NOTE:</strong> If you need to submit a new certificate, send insurance certificates to <a href="mailto:insurance@portlandoregon.gov">insurance@portlandoregon.gov</a>.
        '#required': true
        '#required_error': 'Your insurance information must be on file if required.'
      renewal_request_acknowledge_trimet:
        '#type': checkbox
        '#title': 'I have notified TriMet if my work is along a transit route.'
        '#description': 'If your work is along a TriMet transit route, you are required to notify them at least five business days in advance of your work. Email TriMet at <a href="mailto:foc@trimet.org">foc@trimet.org</a> before you submit this application.'
        '#required': true
        '#required_error': 'You must notify TriMet if your work is along a transit route.'
      renewal_request_acknowledge_conditions:
        '#type': checkbox
        '#title': 'I have read and agree with the conditions of this permit (see below).'
        '#description': |-
          By applying to obtain this permit from the City of Portland, the permittee agrees to comply with all permit conditions, including, without limitation, the permit conditions stated here:<br />
          <a target="_blank" href="/transportation/permitting/documents/temporary-street-use-permit-conditions/download">Conditions of a Permit to Use a Dedicated Street Area</a><br />
          <a target="_blank" href="/transportation/permitting/documents/non-metered-parking-reservation-overview/download">Parking Enforcement verification procedure</a><br />
          <a target="_blank" href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees">Change Fee and Refund Policies</a>
        '#required': true
        '#required_error': 'You must agree with the permit conditions.'
  permit_location_metered:
    '#type': webform_computed_twig
    '#title': 'Computed location metered boolean'
    '#wrapper_attributes':
      class:
        - d-none
    '#display_on': form
    '#mode': text
    '#template': '{{ data.report_location.location_region_id ? "true" : "false" }}'
    '#whitespace': spaceless
    '#store': true
  page_location:
    '#type': webform_wizard_page
    '#title': Location
    '#states':
      visible:
        - ':input[name="wizard_permit_need"]':
            value: parking
        - or
        - ':input[name="wizard_permit_need"]':
            value: traffic
    markup_location_info:
      '#type': webform_markup
      '#markup': |-
        <p>You can only close/reserve one street per application. If you will be working on more than one street, you&#39;ll need to submit a new application for each street.</p>

        <p><strong>NOTE:</strong> Please make sure the street you are working on is not restricted by a&nbsp;<a href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-moratorium-dates-and-maps" target="_blank">Moratorium</a>.</p>
    report_location:
      '#type': portland_location_picker
      '#title': 'Permit Location'
      '#required': true
      '#location_search__title': 'What is the address where this closure or reservation will take place?'
      '#location_search__description': '<p>Please enter the address below. <strong>Move the pin to the exact area of your closure/reservation.</strong></p>'
      '#location_lat__required': true
      '#place_name__access': false
      '#location_details__access': false
      '#location_type__access': false
      '#location_park_container__access': false
      '#location_private_owner__access': false
      '#precision_text__access': false
      '#waterway_instructions__access': false
      '#require_boundary': true
      '#click_query_url': 'https://www.portlandmaps.com/arcgis/rest/services/Public/Tickets_Layers/MapServer/1/query?where=1%3D1&geometry={{x}}%2C{{y}}&returnGeometry=false&geometryType=esriGeometryPoint&outFields=meterdistr&f=geojson'
      '#click_query_property_path': 'features[0].properties.meterdistr'
    markup_taxlot_warning:
      '#type': webform_markup
      '#states':
        visible:
          ':input[name="report_location[location_type_taxlot]"]':
            value: 'true'
      '#markup': '<div class="webform-alert alert alert--warning" aria-hidden="true"><strong>IMPORTANT:</strong> Your location appears to be within a property/tax lot. Please click, tap, or drag the map marker to a precise location within the right of way.</div>'
  page_dates:
    '#type': webform_wizard_page
    '#title': Dates
    '#states':
      visible:
        - ':input[name="wizard_permit_need"]':
            value: parking
        - or
        - ':input[name="wizard_permit_need"]':
            value: traffic
    markup_permit_earliest_start_date:
      '#type': webform_markup
      '#markup': '<p><strong>The soonest enforceable start date for your permit would be: </strong><span class="earliest-start-date">...</span></p>'
    permit_date_days_of_week:
      '#type': checkboxes
      '#title': 'What days of the week would you like your permit to be active?'
      '#options':
        monday: Monday
        tuesday: Tuesday
        wednesday: Wednesday
        thursday: Thursday
        friday: Friday
        saturday: Saturday
        sunday: Sunday
      '#required': true
    permit_date_start:
      '#type': date
      '#title': 'Start Date'
      '#required': true
      '#date_date_min': today
      '#date_date_format': ''
    permit_date_end:
      '#type': date
      '#title': 'End Date'
      '#required': true
      '#date_date_min': today
    markup_permit_date_calculator:
      '#type': webform_markup
      '#admin_title': 'Date Calculator'
      '#markup': '<p class="date-calculator"></p>'
    markup_date_error:
      '#type': webform_markup
      '#admin_title': 'Date Error'
      '#markup': '<p aria-live="polite" class="date-error fw-bold invalid-feedback">Please select a date above to continue.</p>'
    container_moratorium:
      '#type': container
      '#states':
        visible:
          ':input[name="hidden_moratorium_details"]':
            '!value': ''
      markup_moratorium:
        '#type': webform_markup
        '#markup': '<div class="webform-alert alert alert--warning">The location you have selected is subject to a <span class="moratorium-category"></span> moratorium affecting <strong class="moratorium-restriction-type"></strong>. The moratorium runs through <strong class="moratorium-dates"></strong>. (<a href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-moratorium-dates-and-maps">More information on moratoriums</a>).</div>'
      moratorium_choice:
        '#type': radios
        '#title': 'How would you like to handle the moratorium?'
        '#options':
          change_dates: 'I will change my dates'
          moving: 'I am moving'
          overnight: 'I will operate from 10 pm - 6 am'
          has_appeal: 'I already have an appeal'
          submit_appeal: 'I would like to submit an appeal to the Moratorium Committee'
        '#options_display': buttons_vertical
        '#required': true
      moratorium_appeal_description:
        '#type': textarea
        '#title': 'Describe how your situation is an emergency that poses an immediate threat to life safety or property damage:'
        '#required': true
        '#states':
          visible:
            ':input[name="moratorium_choice"]':
              value: submit_appeal
      moratorium_appeal_number:
        '#type': textfield
        '#title': 'Please enter your appeal application number:'
        '#required': true
        '#states':
          visible:
            ':input[name="moratorium_choice"]':
              value: has_appeal
      markup_change_dates:
        '#type': webform_markup
        '#states':
          visible:
            ':input[name="moratorium_choice"]':
              value: change_dates
        '#admin_title': 'Change Dates Message'
        '#markup': '<p class="fw-bold invalid-feedback">Please change the dates above to continue.</p>'
    container_date_unenforceable:
      '#type': container
      '#states':
        visible:
          - ':input[name="permit_date_span"]':
              value:
                greater: '0'
            ':input[name="permit_date_unenforceable"]':
              value: 'true'
            ':input[name="permit_type"]':
              value: ''
          - or
          - ':input[name="permit_date_span"]':
              value:
                greater: '0'
            ':input[name="permit_date_unenforceable"]':
              value: 'true'
            ':input[name="permit_type"]':
              value:
                pattern: bureau|contractor|fun
            ':input[name="permit_location_metered"]':
              value: 'true'
      markup_date_unenforceable_parking:
        '#type': webform_markup
        '#states':
          visible:
            ':input[name="permit_type"]':
              value:
                pattern: parking_only|7day
        '#admin_title': 'Date Unenforceable Message - Parking'
        '#markup': '<p><strong>Requesting immediate dates:</strong> The start date you selected is sooner than we can typically accommodate. Reserving parking requires placing signage in advance, so we may be unable to meet your requested start date and you may be unable to have any enforcement of your reserved zone.</p>'
      markup_date_unenforceable_traffic_control:
        '#type': webform_markup
        '#states':
          visible:
            ':input[name="permit_type"]':
              value:
                '!pattern': parking_only|7day
        '#admin_title': 'Date Unenforceable Message - Other'
        '#markup': '<p><strong>Requesting immediate dates:</strong> The start date you selected is sooner than we can typically accommodate, and we may be unable to meet your requested start date. As soon as we are able to process your application, we will let you know the soonest start date we can manage.</p>'
      permit_date_unenforceable_agree:
        '#type': checkbox
        '#title': 'I understand the above'
        '#required': true
        '#required_error': 'You must acknowledge this.'
    permit_date_span:
      '#type': hidden
      '#title': 'Date Span (hidden, computed by JS)'
      '#default_value': '0'
    permit_date_unenforceable:
      '#type': hidden
      '#title': 'Is Date Unenforceable (hidden, computed by JS)'
      '#default_value': ''
    hidden_moratorium_details:
      '#type': hidden
      '#title': 'Hidden - Moratorium Details, if any (computed by JS)'
    actions_wizard_prev:
      '#type': webform_actions
      '#title': 'Previous Button'
      '#attributes':
        style: 'display: inline-block;'
      '#submit_hide': true
      '#reset_hide': true
      '#update_hide': true
      '#wizard_next_hide': true
    actions_wizard_next:
      '#type': webform_actions
      '#title': 'Next Button'
      '#states':
        visible:
          ':input[name="permit_date_span"]':
            value:
              greater: '0'
      '#attributes':
        style: 'display: inline-block;'
      '#submit_hide': true
      '#reset_hide': true
      '#update_hide': true
      '#wizard_prev_hide': true
    actions_reset:
      '#type': webform_actions
      '#title': 'Reset Button'
      '#attributes':
        style: 'display: inline-block;'
      '#update_hide': true
      '#wizard_prev_hide': true
      '#wizard_next_hide': true
  page_parking_spaces:
    '#type': webform_wizard_page
    '#title': 'Parking Spaces'
    '#states':
      visible:
        ':input[name="permit_type"]':
          value:
            pattern: 7day|parking_only
    permit_amount_20ft_spaces:
      '#type': number
      '#title': 'How many 20ft spaces will you require?'
      '#field_suffix': ' space(s)'
      '#required': true
      '#default_value': '1'
      '#min': 1
      '#step': 1
    permit_street_28ft_wide:
      '#type': radios
      '#title': 'Is your street at least 28ft wide?'
      '#description_display': before
      '#description': 'Don''t know? You can use <a target="_blank" href="https://pdx.maps.arcgis.com/apps/webappviewer/index.html?id=f68278b842164d6784bef5f6cc5c5ae9">this map tool</a> to get a rough idea. Click on the ruler icon <img width="24" height="24" src="https://www.portland.gov/sites/default/files/2025/tsup-ruler-icon_0.png" /> at the top left of the map, just beneath the search box. '
      '#options':
        'Yes': 'Yes'
        'No / Unknown': 'No / Unknown'
      '#required': true
      '#states':
        visible:
          ':input[name="permit_location_metered"]':
            value: 'false'
          ':input[name="permit_amount_20ft_spaces"]':
            value:
              less_equal: '5'
          ':input[name="permit_date_span"]':
            value:
              less_equal: '7'
    permit_restricted_parking_zone:
      '#type': radios
      '#title': 'Are any of the below parking restrictions present at your location?'
      '#description': 'Such as: No Parking (all hours or limited hours), Pay To Park, Transit, Car Share. Here are some example signs you may see in such areas:<br><br><img width="300" src="/sites/default/files/2022/apply_tsup-7day_permit.png" alt="Example of restricted parking signs" />'
      '#description_display': before
      '#options':
        'Yes': 'Yes'
        'No': 'No'
      '#required': true
      '#states':
        visible:
          ':input[name="permit_street_28ft_wide"]':
            checked: true
  page_7day_permit:
    '#type': webform_wizard_page
    '#title': 'Request Details'
    '#states':
      visible:
        ':input[name="permit_type"]':
          value: 7day
    '#admin_title': '7-Day Permit'
    markup_7day_permit_introduction:
      '#type': processed_text
      '#text': |
        <h2>Apply for a Parking Reservation</h2>

        <p>This permit only allows you to reserve legal parking spaces outside of the <a href="https://pdx.maps.arcgis.com/apps/MapSeries/index.html?appid=ad171d005d4442bba3c640735d070aa3" target="_blank">Metered Parking Districts.</a> This permit is not valid in the following restricted parking zones: No Parking (all hours or limited hours), Pay To Park, Transit, Car Share.</p>

        <p>Here are some example signs you may see in areas where this permit <strong>Shall Not Be Used</strong>:</p>

        <drupal-entity data-align="narrow" data-embed-button="image_browser" data-entity-embed-display="view_mode:media.banner" data-entity-type="media" data-entity-uuid="4c68b8cf-3bc2-4b03-a35d-a332762dd870"></drupal-entity>

        <p><strong>Please read and review the&nbsp;<a href="/transportation/permitting/documents/non-metered-parking-reservation-overview/download" target="_blank">Parking Enforcement Reservation Procedure</a>. Parking Enforcement will only enforce your no parking signs if the verification process has been completed. Additional fees apply to complete the verification process.</strong></p>
      '#format': simplified_editor_with_media_embed
    7day_permit_street_name:
      '#type': textfield
      '#title': 'What street will you be reserving parking on?'
      '#placeholder': 'e.g. NW Glisan St'
      '#required': true
    7day_permit_reason:
      '#type': select
      '#title': 'What will the space(s) be used for?'
      '#options':
        construction: Construction
        event: 'Event loading/unloading'
        moving_delivery: 'Moving or Delivery'
        property_maintenance: 'Property Maintenance'
        tree_trimming: 'Tree Trimming'
        utility_work: 'Utility Work'
      '#required': true
    7day_permit_acknowledge_nonmetered:
      '#type': checkbox
      '#title': 'I understand that this permit is NOT valid in Metered Parking Districts.'
      '#required': true
      '#required_error': 'You must acknowledge this.'
      '#states':
        visible:
          ':input[name="7day_permit_reason"]':
            '!value': ''
    7day_permit_acknowledge_width:
      '#type': checkbox
      '#title': 'I understand that this permit is not valid on streets less than 28 feet wide.'
      '#required': true
      '#required_error': 'You must acknowledge this.'
      '#states':
        visible:
          ':input[name="7day_permit_acknowledge_nonmetered"]':
            checked: true
    7day_permit_acknowledge_scope:
      '#type': checkbox
      '#title': 'I understand that this permit is only for moving, utility work, property maintenance, construction, and event loading/unloading.'
      '#required': true
      '#required_error': 'You must acknowledge this.'
      '#states':
        visible:
          ':input[name="7day_permit_acknowledge_width"]':
            checked: true
    7day_permit_acknowledge_conditions:
      '#type': checkbox
      '#title': 'I understand that obtaining this permit does not automatically reserve a specific parking space, nor guarantee availability of a space to reserve.'
      '#description': 'I understand that I am responsible for reserving parking spaces by posting the appropriate parking reservation signs and following the <a target="_blank" href="/transportation/permitting/documents/non-metered-parking-reservation-overview/download">Parking Enforcement verification procedure.</a>'
      '#required': true
      '#required_error': 'You must acknowledge this.'
      '#states':
        visible:
          ':input[name="7day_permit_acknowledge_scope"]':
            checked: true
  page_simple_permit:
    '#type': webform_wizard_page
    '#title': 'Request Details'
    '#states':
      visible:
        ':input[name="permit_type"]':
          value: parking_only
    '#admin_title': 'Simple Permit'
    markup_simple_permit_introduction:
      '#type': processed_text
      '#text': |
        <h2>Apply for a Parking Reservation</h2>

        <p>This form should be used for parking-only requests. You cannot use this form to request the use or closure of sidewalks, bike/traffic lanes, or streets.<br />
        This form is intended for the temporary reservation of parking to facilitate things like:</p>

        <ul>
        	<li>Residential moves</li>
        	<li>Commercial moves</li>
        	<li>Loading/unloading for events</li>
        	<li>Short term construction/utility work</li>
        	<li>Tree trimming</li>
        </ul>
      '#format': simple_editor
    simple_permit_requested_times:
      '#type': textfield
      '#title': 'Requested Start and End times (include AM or PM)'
      '#placeholder': 'e.g. 7am-4pm or All Hours'
      '#required': true
    simple_permit_reason:
      '#type': textfield
      '#title': 'Why are you requesting this permit?'
      '#placeholder': 'e.g. Moving, Construction, Loading/Unloading'
      '#required': true
    simple_permit_occupying:
      '#type': webform_select_other
      '#title': 'What will you be parking in the spaces?'
      '#options':
        moving: 'Moving Van/Truck'
        storage: 'Storage Container'
        construction: 'Trucks, Material, and Equipment'
        dropbox: 'Dropbox / Dumpster'
      '#empty_option': '-- NO PASSENGER VEHICLES OR SUVS PERMITTED --'
      '#other__option_label': Other
      '#other__placeholder': 'If other, please specify'
      '#required': true
    simple_permit_street_name:
      '#type': textfield
      '#title': 'Name of the street you wish to reserve parking on'
      '#placeholder': 'e.g. NW Glisan St'
      '#required': true
      '#states':
        visible:
          ':input[name="simple_permit_occupying[select]"]':
            '!value': ''
      '#states_clear': false
    simple_permit_street_side:
      '#type': select
      '#title': 'Which side of the street?'
      '#options':
        north: North
        south: South
        east: East
        west: West
        both: 'Both Sides'
      '#required': true
      '#states':
        visible:
          ':input[name="simple_permit_occupying[select]"]':
            '!value': ''
      '#states_clear': false
    simple_permit_cross_street_left:
      '#type': textfield
      '#title': 'If you were standing at the location, facing the street, what would be the nearest cross street on your left?   '
      '#placeholder': 'e.g. NW 11th Ave'
      '#required': true
      '#states_clear': false
      '#states':
        visible:
          ':input[name="simple_permit_street_side"]':
            '!value': ''
    simple_permit_cross_street_right:
      '#type': textfield
      '#title': 'If you were standing at the location, facing the street, what would be the nearest cross street on your right?   '
      '#placeholder': 'e.g. NW 12th Ave'
      '#required': true
      '#states_clear': false
      '#states':
        visible:
          ':input[name="simple_permit_cross_street_left"]':
            filled: true
    simple_permit_street_confirmation_title:
      '#type': webform_computed_twig
      '#title': 'Street confirmation title'
      '#title_display': none
      '#states':
        invisible:
          - ':input[name="simple_permit_street_confirmation"]':
              checked: true
          - or
          - ':input[name="simple_permit_cross_street_right"]':
              empty: true
      '#display_on': form
      '#mode': html
      '#template': 'So you want to reserve <strong>{{ (20 * data.permit_amount_20ft_spaces|default(0))|number_format }} ft</strong> of the <strong>{{ data.simple_permit_street_side }}</strong> side of <strong>{{ data.simple_permit_street_name }}</strong>, between <strong>{{ data.simple_permit_cross_street_left }}</strong> and <strong>{{ data.simple_permit_cross_street_right }}</strong>?'
      '#ajax': true
    simple_permit_street_confirmation:
      '#type': checkbox
      '#title': "Yes, that's correct"
      '#required': true
      '#states':
        invisible:
          - ':input[name="simple_permit_cross_street_right"]':
              empty: true
          - or
          - ':input[name="simple_permit_street_confirmation"]':
              checked: true
      '#states_clear': false
    simple_permit_location_description:
      '#type': textfield
      '#title': 'Please specify exactly where you would like the parking reserved on the street'
      '#description_display': before
      '#description': "This information is used to help process your application. This permit application doesn't hold a particular space; that is done by placing your signage once the permit is issued."
      '#placeholder': "e.g. 'Closest to e.g. NW 12th Ave.' or '40 ft west of e.g. NW 11th Ave'"
      '#required': true
      '#states':
        visible:
          ':input[name="simple_permit_street_confirmation"]':
            checked: true
    simple_permit_bds_associated:
      '#type': webform_radios_other
      '#title': 'Is this request associated with a permit issued by the Bureau of Development services (i.e. building permit, trade permit, etc)?'
      '#options':
        'No': 'No'
      '#options_display': buttons_horizontal
      '#other__option_label': 'Yes'
      '#other__title': 'Please provide the permit number or IVR #'
      '#other__placeholder': ''
      '#required': true
      '#states':
        visible:
          ':input[name="simple_permit_street_confirmation"]':
            checked: true
    simple_permit_additional_info:
      '#type': textarea
      '#title': 'Additional Info'
      '#placeholder': "Please provide us with any additional information here, such as location, purpose, time, that didn't fit in anywhere above."
      '#states':
        visible:
          ':input[name="simple_permit_bds_associated[radios]"]':
            checked: true
    simple_permit_attachment:
      '#type': webform_document_file
      '#title': 'Optionally, attach a picture, drawing, or map showing where you would like to reserve parking.'
      '#multiple': 8
      '#max_filesize': '30'
      '#file_help': help
      '#file_extensions': 'pdf jpg jpeg png'
      '#states':
        visible:
          ':input[name="simple_permit_bds_associated[radios]"]':
            checked: true
    simple_permit_acknowledge_conditions:
      '#type': checkbox
      '#title': 'I have read and agree with the conditions of this permit (see below).'
      '#description': |-
        By applying to obtain this permit from the City of Portland, the permittee agrees to comply with all permit conditions, including, without limitation, the permit conditions stated here:<br />
        <a target="_blank" href="/transportation/permitting/documents/temporary-street-use-permit-conditions/download">Conditions of a Permit to Use a Dedicated Street Area</a><br />
        <a target="_blank" href="/transportation/permitting/documents/non-metered-parking-reservation-overview/download">Parking Enforcement verification procedure</a><br />
        <a target="_blank" href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees">Change Fee and Refund Policies</a>
      '#required': true
      '#required_error': 'You must agree with the permit conditions.'
      '#states':
        visible:
          ':input[name="simple_permit_bds_associated[radios]"]':
            checked: true
  page_complex_permit:
    '#type': webform_wizard_page
    '#title': 'Request Details'
    '#states':
      visible:
        ':input[name="permit_type"]':
          value:
            pattern: traffic_control|fun|bureau|contractor|sidewalk_repair
    '#admin_title': 'Complex Permit (Traffic Control/FUN/Bureau/Contractor/Sidewalk Repair)'
    markup_complex_permit_introduction_traffic_control:
      '#type': processed_text
      '#states':
        visible:
          ':input[name="permit_type"]':
            value:
              pattern: traffic_control
      '#text': |
        <h2>Apply for a permit with Traffic Control</h2>

        <p>This permit is required for the temporary use or closure of a sidewalk, bike/traffic lane, or street, and any associated parking.</p>
      '#format': simple_editor
    markup_complex_permit_introduction_fun:
      '#type': processed_text
      '#states':
        visible:
          ':input[name="permit_type"]':
            value: fun
      '#text': |
        <h2>Submit a Franchise Utility Notification</h2>

        <p>This Notification is a condition of the Franchise Utility Notification (FUN) permit. Parties eligible to use this form have been issued an annual FUN Permit.</p>
      '#format': simple_editor
    markup_complex_permit_introduction_bureau:
      '#type': processed_text
      '#states':
        visible:
          ':input[name="permit_type"]':
            value: bureau
      '#text': |
        <h2>Notification of City Bureau Work in the Right of Way</h2>

        <p>This Notification serves to coordinate work in the Right of Way</p>
      '#format': simple_editor
    markup_complex_permit_introduction_contractor:
      '#type': processed_text
      '#states':
        visible:
          ':input[name="permit_type"]':
            value: contractor
      '#text': |
        <h2>Notification of Contracted City Bureau Work in the Right of Way</h2>

        <p>This Notification serves to coordinate contracted work in the Right of Way being performed by companies under contract for the City of Portland or City Partner Agencies.</p>
      '#format': simple_editor
    markup_complex_permit_introduction_sidewalk_repair:
      '#type': processed_text
      '#states':
        visible:
          ':input[name="permit_type"]':
            value: sidewalk_repair
      '#text': |
        <h2>Notification of Sidewalk Repair Work</h2>

        <p>If you have obtained a Voluntary Sidewalk Repair Permit, Mandatory Sidewalk Repair Permit, or Minor Improvement Permit and need close the sidewalk to perform the work, please use this form to notify PBOT of your sidewalk closure dates. Please reference your permit number below.</p>
      '#format': simple_editor
    section_complex_permit_details:
      '#type': webform_section
      '#title': 'Request Details'
      '#title_tag': h3
      complex_permit_street_name:
        '#type': textfield
        '#title': 'Name of the street you wish to request a permit for'
        '#placeholder': 'e.g. NW Glisan St'
        '#required': true
      complex_permit_street_side:
        '#type': select
        '#title': 'Which side of the street?'
        '#options':
          north: North
          south: South
          east: East
          west: West
          both: 'Both Sides'
        '#required': true
      complex_permit_cross_street_left:
        '#type': textfield
        '#title': 'If you were standing at the location, facing the street, what would be the nearest cross street on your left?   '
        '#placeholder': 'e.g. NW 11th Ave'
        '#required': true
        '#states_clear': false
        '#states':
          visible:
            ':input[name="complex_permit_street_side"]':
              '!value': ''
      complex_permit_cross_street_right:
        '#type': textfield
        '#title': 'If you were standing at the location, facing the street, what would be the nearest cross street on your right?   '
        '#placeholder': 'e.g. NW 12th Ave'
        '#required': true
        '#states_clear': false
        '#states':
          visible:
            ':input[name="complex_permit_cross_street_left"]':
              filled: true
      complex_permit_street_confirmation_title:
        '#type': webform_computed_token
        '#title': 'Street confirmation title'
        '#title_display': none
        '#states':
          invisible:
            - ':input[name="complex_permit_street_confirmation"]':
                checked: true
            - or
            - ':input[name="complex_permit_cross_street_right"]':
                empty: true
        '#display_on': form
        '#mode': html
        '#template': 'So you want to request a permit for the <strong>[webform_submission:values:complex_permit_street_side:raw]</strong> side of <strong>[webform_submission:values:complex_permit_street_name]</strong>, between <strong>[webform_submission:values:complex_permit_cross_street_left]</strong> and <strong>[webform_submission:values:complex_permit_cross_street_right]</strong>?'
        '#ajax': true
      complex_permit_street_confirmation:
        '#type': checkbox
        '#title': "Yes, that's correct"
        '#required': true
        '#states_clear': false
        '#states':
          invisible:
            - ':input[name="complex_permit_cross_street_right"]':
                empty: true
            - or
            - ':input[name="complex_permit_street_confirmation"]':
                checked: true
      container_after_confirmation:
        '#type': container
        '#states':
          visible:
            ':input[name="complex_permit_street_confirmation"]':
              checked: true
        complex_permit_traffic_control_work_type:
          '#type': webform_select_other
          '#title': 'What type of work is this request for?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value:
                  pattern: traffic_control
          '#options':
            utility_work: 'Utility Work'
            building_construction: 'Building Construction'
            property_maintenance: 'Property Maintenance'
          '#other__option_label': Other
          '#other__placeholder': 'If other, please specify'
          '#required': true
        complex_permit_fun_work_type:
          '#type': webform_select_other
          '#title': 'What type of work is this request for?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: fun
          '#options':
            maintenance: Maintenance
            new_infrastructure: 'New Infrastructure'
            vegetation: 'Vegetation Management'
            inspection: Inspection
          '#other__option_label': Other
          '#other__placeholder': 'If other, please specify'
          '#required': true
        complex_permit_bureau_work_type:
          '#type': webform_select_other
          '#title': 'What type of work is this request for?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: bureau
          '#options':
            maintenance: Maintenance
            new_infrastructure: 'New Infrastructure'
            clearance: Clearance
            loading: 'Loading / Unloading'
          '#other__option_label': Other
          '#other__placeholder': 'If other, please specify'
          '#required': true
        complex_permit_contractor_work_type:
          '#type': webform_select_other
          '#title': 'What type of work is this request for?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: contractor
          '#options':
            maintenance: Maintenance
            new_infrastructure: 'New Infrastructure'
            clearance: Clearance
            loading: 'Loading / Unloading'
          '#other__option_label': Other
          '#other__placeholder': 'If other, please specify'
          '#required': true
        complex_permit_closure_type:
          '#type': checkboxes
          '#title': 'What type of closure(s) are you requesting?'
          '#states':
            visible:
              ':input[name="wizard_permit_need"]':
                value: traffic
              ':input[name="permit_type"]':
                '!value': sidewalk_repair
          '#options':
            street: Street
            bike_lane: 'Bike Lane'
            lane: Lane
            sidewalk_use: 'Sidewalk Use (with ADA Clearance)'
            sidewalk: 'Sidewalk Closure'
            parking: Parking
          '#required': true
        complex_permit_lanes_affected:
          '#type': number
          '#title': 'How many lanes will you be affecting (Bicycle and Travel)?'
          '#states':
            visible:
              - ':input[name="complex_permit_closure_type[bike_lane]"]':
                  checked: true
              - or
              - ':input[name="complex_permit_closure_type[lane]"]':
                  checked: true
          '#min': 1
          '#step': 1
          '#required': true
        markup_street_closures:
          '#type': webform_markup
          '#states':
            visible:
              ':input[name="complex_permit_closure_type[street]"]':
                checked: true
          '#markup': |-
            <strong>For street closures:</strong><br />
            <br />
            On one-way streets, all of the available on-street parking must be reserved on the entire block in between the two nearest cross streets. This is regardless of the size of your workspace.<br />
            <br />
            On two-way streets, you are only required to reserve the parking directly within your work
        markup_sidewalk_closures:
          '#type': webform_markup
          '#states':
            visible:
              ':input[name="complex_permit_closure_type[sidewalk]"]':
                checked: true
          '#markup': |-
            <strong>For sidewalk closures:</strong><br />
            <br />
            If there is on-street parking adjacent to the sidewalk you are closing, you are required to reserve it. Please make sure your application includes these spaces.
        complex_permit_parking_spaces_affected:
          '#type': number
          '#title': 'How many parking spaces will you be impacting?'
          '#states':
            visible:
              - ':input[name="complex_permit_closure_type[parking]"]':
                  checked: true
              - or
              - ':input[name="wizard_permit_need"]':
                  value: parking
          '#description_display': before
          '#required': true
          '#min': 0
          '#step': 1
        complex_permit_bds_associated:
          '#type': webform_radios_other
          '#title': 'Is this request associated with a permit issued by Portland Permitting & Development (i.e. building permit, trade permit, etc)?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value:
                  pattern: traffic_control
          '#options':
            'No': 'No'
          '#options_display': buttons_horizontal
          '#other__option_label': 'Yes'
          '#other__title': 'Please provide the permit number or IVR #'
          '#other__placeholder': ''
          '#required': true
        section_required_documents:
          '#type': webform_section
          '#title': 'Required Documents'
          '#title_tag': h3
          '#states':
            visible:
              ':input[name="wizard_permit_need"]':
                value: traffic
              ':input[name="permit_type"]':
                '!value': sidewalk_repair
          markup_documents_traffic_control:
            '#type': webform_markup
            '#states':
              visible:
                ':input[name="permit_type"]':
                  value:
                    pattern: traffic_control
            '#markup': '<p>You are required to prepare a plan showing your proposed closure using the <a href="https://pdx.maps.arcgis.com/apps/webappviewer/index.html?id=f68278b842164d6784bef5f6cc5c5ae9">PBOT Basemap</a> and attach it below. <strong>If your plan is not created on the </strong><a href="https://pdx.maps.arcgis.com/apps/webappviewer/index.html?id=f68278b842164d6784bef5f6cc5c5ae9"><strong>PBOT Basemap</strong></a><strong>, your application will be rejected and you''ll need to reapply.</strong></p>'
          container_tcp_required:
            '#type': container
            '#states':
              visible:
                - ':input[name="wizard_permit_need"]':
                    value: traffic
                  ':input[name="permit_type"]':
                    '!value': sidewalk_repair
                  ':input[name="hidden_location_busy"]':
                    value:
                      pattern: lineMarkings
                  ':input[name="complex_permit_lanes_affected"]':
                    value:
                      greater: 1
                - or
                - ':input[name="wizard_permit_need"]':
                    value: traffic
                  ':input[name="permit_type"]':
                    '!value': sidewalk_repair
                  ':input[name="hidden_location_busy"]':
                    value:
                      pattern: trafficSignals
                - or
                - ':input[name="wizard_permit_need"]':
                    value: traffic
                  ':input[name="permit_type"]':
                    '!value': sidewalk_repair
                  ':input[name="hidden_location_busy"]':
                    value:
                      pattern: lineMarkings
                  ':input[name="complex_permit_closure_type[street]"]':
                    checked: true
            markup_documents_tcp_required:
              '#type': webform_markup
              '#markup': '<p>Based on your selection a site-specific <strong>Traffic Control Plan (TCP)</strong> is required, you''ll need to prepare a plan that includes all the traffic control devices you will use to manage pedestrian and vehicle traffic at the jobsite. You can attach your TCP in the section below. For more information on what an appropriate TCP looks like, please visit our <a href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-traffic-control-plan-work-space-diagram-requirements">Traffic Control Plan Information Page.</a></p>'
            complex_permit_document_choice_tcp_required:
              '#type': radios
              '#title': 'Select one of the following documents to upload:'
              '#required': true
              '#options':
                unreviewed_tcp: 'I will submit a site-specific Traffic Control Plan that has not yet been reviewed by a PBOT Traffic Engineer.'
                approved_tcp: 'I will submit a site-specific Traffic Control Plan that has already been approved by a PBOT Traffic Engineer.'
          container_wsd_required:
            '#type': container
            '#states':
              visible:
                ':input[name="wizard_permit_need"]':
                  value: traffic
                ':input[name="permit_type"]':
                  '!value': sidewalk_repair
                ':input[name="hidden_location_busy"]':
                  value:
                    '!pattern': lineMarkings|trafficSignals
            markup_documents_wsd_required:
              '#type': webform_markup
              '#markup': '<p>Based on your selection you must upload a <strong>Work Space Diagram</strong> that shows your planned area of impact to the right of way, but omits traffic control devices and has less detail than a full Traffic Control Plan.  Refer to the Traffic Control Manual for your Traffic Control setup in the field. Create a WSD by drawing a box or other polygon over your work space on the <a href="https://pdx.maps.arcgis.com/apps/webappviewer/index.html?id=f68278b842164d6784bef5f6cc5c5ae9">PBOT Basemap</a>. Here is an example of a simple work space diagram: <a href="/transportation/permitting/documents/example-wsd/download">Work Space Diagram.&nbsp;</a></p>'
            complex_permit_document_choice_wsd_required:
              '#type': radios
              '#title': 'Select one of the following documents to upload:'
              '#required': true
              '#options':
                wsd: 'I will adhere to the PBOT Traffic Manual and submit a Work Space Diagram.'
                parking_only: 'I am only requesting parking and will not be impacting traffic in any way, I will submit a Parking Diagram.'
        complex_permit_document_choice_parking_only:
          '#type': radios
          '#title': 'Select one of the following documents to upload:'
          '#states':
            visible:
              ':input[name="wizard_permit_need"]':
                value: parking
              ':input[name="permit_type"]':
                '!value': sidewalk_repair
          '#required': true
          '#options':
            parking_only: 'I am only requesting parking and will not be impacting traffic in any way, I will submit a Parking Diagram.'
        complex_permit_sidewalk_repair_closure:
          '#type': radios
          '#title': 'Until Sidewalk repairs are completed I will:'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: sidewalk_repair
          '#required': true
          '#options':
            open_with_clearance: 'Maintain 4ft of clearance along the entire sidewalk path in accordance with ADA requirements and allow pedestrian access at all times.'
            closed: 'Completely close the sidewalk, allowing no pedestrian access.'
        complex_permit_traffic_documents:
          '#type': webform_document_file
          '#title': 'Please upload the required document(s):'
          '#states':
            visible:
              ':input[name="permit_type"]':
                '!value': sidewalk_repair
          '#multiple': 8
          '#required': true
          '#file_help': help
          '#max_filesize': '30'
          '#file_extensions': 'pdf jpg jpeg png'
        complex_permit_sidewalk_repair_documents:
          '#type': webform_document_file
          '#title': 'Upload any plans or supporting documentation (e.g. a map of the closure)'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: sidewalk_repair
          '#multiple': 8
          '#file_help': help
          '#max_filesize': '30'
          '#file_extensions': 'pdf jpg jpeg png'
        container_acknowledgements:
          '#type': container
          complex_permit_acknowledge_supervision:
            '#type': checkbox
            '#title': 'I certify that the person implementing traffic control measures will be under the supervision of a competent person experienced and knowledgeable in safely setting up temporary traffic control devices.'
            '#states':
              visible:
                ':input[name="wizard_permit_need"]':
                  value: traffic
                ':input[name="permit_type"]':
                  '!value': sidewalk_repair
            '#required': true
            '#required_error': 'You must certify.'
          complex_permit_acknowledge_properties:
            '#type': checkbox
            '#title': 'I have notified adjacent properties of the forthcoming work, in accordance with the Work Notification Requirements presented in the Temporary Traffic Control Manual.'
            '#required': true
            '#required_error': 'You must notify adjacent properties.'
          complex_permit_acknowlege_insurance:
            '#type': checkbox
            '#title': 'My insurance information is on file or is being submitted'
            '#states':
              visible:
                ':input[name="permit_type"]':
                  value:
                    pattern: traffic_control
            '#description': |-
              An <strong>Insurance Certificate</strong> must be on file naming the City of Portland as additionally insured.<br/><br/>

              <strong>The City of Portland must have your current insurance information on file before a permit can be issued.</strong> Email insurance documents to <a href="mailto:insurance@portlandoregon.gov">insurance@portlandoregon.gov</a> or call <a href="tel:+1-503-823-7142">503-823-7142</a> with questions.<br/><br/>

              For more information about the insurance requirements, please visit our <a target="_blank" href="/transportation/permitting/insurance-and-bond-requirements-permits-public-right-way">Insurance page</a>.
            '#required': true
            '#required_error': 'Your insurance information must be on file.'
          complex_permit_acknowledge_trimet:
            '#type': checkbox
            '#title': 'I have notified TriMet if my work is along a transit route.'
            '#description': 'If your work is along a TriMet transit route, you are required to notify them at least five business days in advance of your work. Email TriMet at <a href="mailto:foc@trimet.org">foc@trimet.org</a> before you submit this application.'
            '#required': true
            '#required_error': 'You must notify TriMet if your work is along a transit route.'
        complex_permit_requested_times:
          '#type': textfield
          '#title': 'Requested Start and End times (include AM or PM)'
          '#placeholder': 'e.g. 7am-4pm or All Hours'
          '#required': true
        complex_permit_sidewalk_permit_number:
          '#type': textfield
          '#title': 'What is your Sidewalk Repair permit number that requires notification?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: sidewalk_repair
          '#required': true
        complex_permit_duration_impact:
          '#type': textfield
          '#title': 'Expected duration of work / ROW impact?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value:
                  '!pattern': traffic_control|sidewalk_repair
          '#required': true
        complex_permit_billing_info:
          '#type': textfield
          '#title': 'Billing information'
          '#description': 'Please provide either a City of Portland SAP code for payment or an email address where we can send an invoice at the end of the month.'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value:
                  'pattern': bureau|contractor
          '#required': true
        complex_permit_bureau_contact:
          '#type': textfield
          '#title': 'Provide the first and last name of your City Bureau contact'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: contractor
          '#required': true
        complex_permit_job_number:
          '#type': textfield
          '#title': 'Job number?'
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: fun
        complex_permit_work_description:
          '#type': textarea
          '#title': 'Work Description'
          '#states':
            invisible:
              ':input[name="permit_type"]':
                value: sidewalk_repair
          '#description': '<p>Please provide a clear description of your proposed work.</p>'
          '#placeholder': 'e.g. "closing a single travel lane and the adjacent sidewalk during crane lift onto the roof at 1120 SW 5th Ave."'
          '#required': true
        complex_permit_additional_info:
          '#type': textarea
          '#title': 'Additional Info'
          '#description': "<p>Please provide us with any additional information here, such as location, purpose, time, that didn't fit in anywhere above.</p>"
        markup_sidewalk_repair_parking:
          '#type': webform_markup
          '#states':
            visible:
              ':input[name="permit_type"]':
                value: sidewalk_repair
          '#markup': '<p>If you need to reserve any parking adjacent to your jobsite, you may do so via <a href="http://www.tsup.info">separate application at www.tsup.info</a>.</p>'
        container_tocs:
          '#type': container
          '#states':
            visible:
              ':input[name="permit_type"]':
                '!value': sidewalk_repair
          complex_permit_acknowledge_conditions:
            '#type': checkbox
            '#title': 'I have read and agree with the conditions of this permit (see below).'
            '#description': |-
              By applying to obtain this permit from the City of Portland, the permittee agrees to comply with all permit conditions, including, without limitation, the permit conditions stated here:<br />
            '#required': true
            '#required_error': 'You must agree with the permit conditions.'
          markup_toc_traffic_control:
            '#type': markup
            '#states':
              visible:
                ':input[name="permit_type"]':
                  value:
                    pattern: traffic_control
            '#markup': |-
              <a target="_blank" href="/transportation/permitting/documents/temporary-street-use-permit-conditions/download">Conditions of a Permit to Use a Dedicated Street Area</a><br />
          container_is_parking:
            '#type': container
            '#states':
              visible:
                - ':input[name="wizard_permit_need"]':
                    value: parking
                - or
                - ':input[name="complex_permit_closure_type[parking]"]':
                    checked: true
            markup_toc_nonmetered_parking_enforcement:
              '#type': markup
              '#states':
                visible:
                  ':input[name="permit_location_metered"]':
                    value: 'false'
              '#markup': |-
                <a target="_blank" href="/transportation/permitting/documents/non-metered-parking-reservation-overview/download">Parking Enforcement verification procedure</a><br />
          markup_toc_change_fee:
            '#type': markup
            '#markup': |-
              <a target="_blank" href="/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees">Change Fee and Refund Policies</a>
  page_general:
    '#type': webform_wizard_page
    '#title': Question
    '#states':
      visible:
        ':input[name="wizard_permit_need"]':
          value: general
    '#admin_title': 'General Permit Question'
    general_comment_details:
      '#type': textarea
      '#title': 'How can we help you?'
      '#required': true
    general_email:
      '#type': webform_email_confirm
      '#title': 'Email Address'
      '#confirm__title': 'Confirm Email Address'
      '#description': 'We will use this to respond to your question.'
      '#description_display': before
      '#required': true
      '#pattern': '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
      '#pattern_error': 'Please enter a correctly formatted email address, such as myname@example.com.'
    general_permit_number:
      '#type': textfield
      '#title': 'Permit/Application Number (Optional)'
      '#description': 'If you already have a permit or a pending application, please provide the number so we can better assist you.'
      '#description_display': before
  page_placeholder_permit:
    '#type': webform_wizard_page
    '#title': 'Request Details'
    '#states':
      visible:
        ':input[name="wizard_permit_need"]':
          '!value': general
        ':input[name="permit_type"]':
          value: unknown
    '#admin_title': 'Placeholder permit page'
  hidden_moratorium_data:
    '#type': hidden
    '#title': 'Hidden - JSON Moratorium Data (used for JS)'
  hidden_location_busy:
    '#type': hidden
    '#title': 'Hidden - Is Location Busy (set by JS)'
  permit_type:
    '#type': webform_computed_twig
    '#title': 'Computed permit type'
    '#wrapper_attributes':
      class:
        - d-none
    '#display_on': form
    '#mode': text
    '#template': |-
      {% set permit_type = "unknown" %}
      {% if data.wizard_permit_need == "existing_permit" %}
        {% set permit_type = "existing_permit" %}
        {% if data.wizard_existing_permit_situation == "change" %}
          {% set permit_type = "change_request" %}
        {% elseif data.wizard_existing_permit_situation == "extend" or data.wizard_existing_permit_situation == "renew" %}
          {% set permit_type = "renewal_request" %}
        {% endif %}
      {# special applicant type (e.g. fun, bureau, contractor, sidewalk_repair) overrides the permit type in all cases except existing permit #}
      {% elseif data.contact_applicant_type != "" %}
        {% set permit_type = data.contact_applicant_type %}
      {% elseif data.wizard_permit_need == "parking" %}
        {% set permit_type = "parking_only" %}

        {% if data.permit_location_metered == "false" and data.permit_street_28ft_wide == "Yes" and data.permit_restricted_parking_zone == "No" %}
          {% set permit_type = "7day" %}
        {% endif %}
      {% elseif data.wizard_permit_need == "traffic" %}
        {% if data.permit_date_span >= 28 %}
          {% set permit_type = "lt_traffic_control" %}
        {% else %}
          {% set permit_type = "traffic_control" %}
        {% endif %}
      {% endif %}

      {{ permit_type }}
    '#whitespace': trim
    '#store': true
  friendly_permit_type:
    '#type': webform_computed_twig
    '#title': 'Friendly permit type (used for Subject field)'
    '#display_on': none
    '#mode': text
    '#template': |-
      {% set name_map = {
        'parking_only': 'Parking Only',
        '7day': 'Parking Reservation Permit',
        'lt_traffic_control': 'Long Term Traffic Control',
        'traffic_control': 'Traffic Control',
        'fun': 'Franchise Utility Notification',
        'bureau': 'City Bureau Notification',
        'contractor': 'Contracted City Bureau Notification',
        'sidewalk_repair': 'Sidewalk Repair Notification',
        'change_request': 'Change Request',
        'renewal_request': 'Renewal Request',
      } %}
      {{ name_map[data.permit_type]|default('Unknown') }}
    '#whitespace': trim
  computed_tags:
    '#type': webform_computed_twig
    '#title': 'Computed tags'
    '#display_on': none
    '#mode': text
    '#template': |-
      {# add tags to set Days of Week custom field #}
      {% for day in data.permit_date_days_of_week %}
        22193428346135_{{ day }}
      {% endfor %}

      {# add tag based on applicant type #}
      {{ data.contact_applicant_type }}

      {% if data.hidden_moratorium_details %}
        moratorium {{ data.moratorium_choice }}
      {% endif %}
    '#whitespace': trim
    '#ajax': true
  computed_permit_reason:
    '#type': webform_computed_twig
    '#title': 'Computed permit reason'
    '#display_on': none
    '#mode': text
    '#template': |-
      {{ webform_token('[webform_submission:values:simple_permit_reason:clear]', webform_submission)
        |default(webform_token('[webform_submission:values:7day_permit_reason:clear]', webform_submission))
        |default(webform_token('[webform_submission:values:complex_permit_' ~ (data.permit_type|replace({ 'lt_': '' })) ~ '_work_type:clear]', webform_submission)) }}
    '#whitespace': trim
    '#store': true
  computed_permit_street_name:
    '#type': webform_computed_twig
    '#title': 'Computed permit street name'
    '#display_on': none
    '#mode': text
    '#template': |-
      {{ webform_token('[webform_submission:values:simple_permit_street_name:clear]', webform_submission)
        |default(webform_token('[webform_submission:values:7day_permit_street_name:clear]', webform_submission))
        |default(webform_token('[webform_submission:values:complex_permit_street_name:clear]', webform_submission)) }}
    '#whitespace': trim
    '#store': true
  computed_num_spaces:
    '#type': webform_computed_twig
    '#title': 'Computed number of parking spaces'
    '#display_on': none
    '#mode': text
    '#template': '{{ data.complex_permit_parking_spaces_affected|default(data.permit_amount_20ft_spaces) }}'
    '#whitespace': trim
    '#store': true
  computed_date_start:
    '#type': webform_computed_twig
    '#title': 'Computed date start'
    '#display_on': none
    '#mode': text
    '#template': "{{ (data.permit_date_start or data.renewal_request_permit_date_start) ? data.permit_date_start|default(data.renewal_request_permit_date_start)|date('Y-m-d') : '' }}"
    '#whitespace': trim
    '#store': true
  computed_date_end:
    '#type': webform_computed_twig
    '#title': 'Computed date end'
    '#display_on': none
    '#mode': text
    '#template': "{{ (data.permit_date_end or data.renewal_request_permit_date_end) ? data.permit_date_end|default(data.renewal_request_permit_date_end)|date('Y-m-d') : '' }}"
    '#whitespace': trim
    '#store': true
  computed_bds_permit_number:
    '#type': webform_computed_twig
    '#title': 'Computed BDS permit number'
    '#display_on': none
    '#mode': text
    '#template': |-
      {% if data.permit_type == 'parking_only' %}
      {% set permit_number = webform_token('[webform_submission:values:simple_permit_bds_associated:clear]', webform_submission) %}
      {% elseif data.permit_type == 'traffic_control' or data.permit_type == 'lt_traffic_control' %}
      {% set permit_number = webform_token('[webform_submission:values:complex_permit_bds_associated:clear]', webform_submission) %}
      {% endif %}
      {{ permit_number == 'No' ? '' : permit_number }}
    '#whitespace': trim
    '#store': true
  computed_ticket_description:
    '#type': webform_computed_twig
    '#title': 'Computed ticket description'
    '#display_on': none
    '#mode': text
    '#ajax': true
    '#template': |-
      {% if false %}
      {% block contact_info %}
        <h3>Contact Info</h3>
        <ul>
          <li>Full Name: <strong>{{ webform_token('[webform_submission:values:contact_full_legal_name]', webform_submission) }}</strong></li>
          {% if data.contact_company %}
          <li>Company Name: <strong>{{ webform_token('[webform_submission:values:contact_company]', webform_submission) }}</strong></li>
          {% endif %}
          <li>Phone Number: <strong>{{ webform_token('[webform_submission:values:contact_phone]', webform_submission) }}</strong></li>
          <li>Email Address: <strong>{{ data.contact_email is iterable ? '' : webform_token('[webform_submission:values:contact_email]', webform_submission) }}</strong></li>
          {% if data.contact_applicant_type %}
          <li>Type of Applicant: <strong>{{ webform_token('[webform_submission:values:contact_applicant_type]', webform_submission) }}</strong></li>
          {% if data.contact_bureau %}
          <li>Bureau: <strong>{{ webform_token('[webform_submission:values:contact_bureau]', webform_submission) }}</strong></li>
          {% endif %}
          {% if data.contact_fun_company %}
          <li>FUN Company: <strong>{{ webform_token('[webform_submission:values:contact_fun_company]', webform_submission) }}</strong></li>
          {% endif %}
          {% endif %}
        </ul>
      {% endblock %}
      {% endif %}

      {% set location_search = webform_token('[webform_submission:values:report_location:location_search:clear]', webform_submission) %}
      {% if data.permit_type == "parking_only" %}
        <h2>Your application</h2>
        <p><strong>You Requested:</strong> {{ webform_token('[webform_submission:values:wizard_permit_need]', webform_submission) }}</p>
        {% if data.hidden_moratorium_details %}
        <h3>Moratorium</h3>
        <p><strong>Based on the dates and location you provided, there is a moratorium in place for this location. You may not be able to obtain a permit for this location.</strong></p>
        <ul>
          <li>Moratorium details: <strong>{{ data.hidden_moratorium_details }}</strong></li>
          <li>Exception provided: <strong>{{ webform_token('[webform_submission:values:moratorium_choice]', webform_submission) }}</strong></li>
          {% if data.moratorium_appeal_number %}
          <li>Appeal application number: <strong>{{ webform_token('[webform_submission:values:moratorium_appeal_number]', webform_submission) }}</strong></li>
          {% endif %}
        </ul>
        {% if data.moratorium_appeal_description %}
        <p><strong>Appeal description:</strong></p>
        <p>{{ webform_token('[webform_submission:values:moratorium_appeal_description]', webform_submission) }}</p>
        {% endif %}
        {% endif %}
        <h3>Location</h3>
        <ul>
          <li>At the address: <strong>{{ webform_token('[webform_submission:values:report_location:location_address]', webform_submission) }}</strong>{% if location_search %}<em> (you entered: {{ location_search }})</em>{% endif %}</li>
          <li>Primary street: <strong>{{ webform_token('[webform_submission:values:simple_permit_street_name]', webform_submission) }}</strong></li>
          <li>Side of the street: <strong>{{ webform_token('[webform_submission:values:simple_permit_street_side]', webform_submission) }}</strong></li>
          <li>Between cross street: <strong>{{ webform_token('[webform_submission:values:simple_permit_cross_street_left]', webform_submission) }}</strong></li>
          <li>And cross street: <strong>{{ webform_token('[webform_submission:values:simple_permit_cross_street_right]', webform_submission) }}</strong></li>
          <li>Exact location of parking: <strong>{{ webform_token('[webform_submission:values:simple_permit_location_description]', webform_submission) }}</strong></li>
        </ul>
        <h3>Dates</h3>
        {% if data.permit_date_unenforceable_agree %}
        <p><strong>The start date you selected is sooner than we can typically accommodate. Reserving parking requires placing signage in advance, so we may be unable to meet your requested start date and you may be unable to have any enforcement of your reserved zone.</strong></p>
        {% endif %}
        <ul>
          <li>Days of week: <strong>{{ webform_token('[webform_submission:values:permit_date_days_of_week]', webform_submission) }}</strong></li>
          <li>Start date: <strong>{{ data.permit_date_start|date('D, m/d/Y') }}</strong></li>
          <li>End date: <strong>{{ data.permit_date_end|date('D, m/d/Y') }}</strong></li>
          <li>Requested Start and End times: <strong>{{ webform_token('[webform_submission:values:simple_permit_requested_times]', webform_submission) }}</strong></li>
        </ul>
        <h3>Permit details</h3>
        <ul>
          <li>How many 20ft spaces: <strong>{{ webform_token('[webform_submission:values:permit_amount_20ft_spaces]', webform_submission) }}</strong></li>
          <li>Requested use: <strong>{{ data.computed_permit_reason }}</strong></li>
          <li>Requested for: <strong>{{ webform_token('[webform_submission:values:simple_permit_occupying]', webform_submission) }}</strong></li>
          <li>Associated BDS permit number: <strong>{{ webform_token('[webform_submission:values:computed_bds_permit_number]', webform_submission) }}</strong></li>
        </ul>
        {% if data.simple_permit_additional_info %}
        <p><strong>Additional Info:</strong></p>
        <p>{{ webform_token('[webform_submission:values:simple_permit_additional_info]', webform_submission) }}</p>
        {% endif %}
        {{ block('contact_info') }}
        <h3>Acknowledgements</h3>
        <p>As part of submitting this application, you agreed with the conditions of this permit:</p>
        <ul>
          <li><a href="https://www.portland.gov/transportation/permitting/documents/temporary-street-use-permit-conditions/download" target="_blank">Conditions of a Permit to Use a Dedicated Street Area</a></li>
          <li><a href="https://www.portland.gov/transportation/permitting/documents/non-metered-parking-reservation-overview/download" target="_blank">Parking Enforcement verification procedure</a></li>
          <li><a href="https://www.portland.gov/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees" target="_blank">Change Fee and Refund Policies</a></li>
        </ul>
      {% elseif data.permit_type == "7day" %}
        <h2>Your application</h2>
        <p><strong>You Requested:</strong> {{ webform_token('[webform_submission:values:wizard_permit_need]', webform_submission) }}</p>
        {% if data.hidden_moratorium_details %}
        <h3>Moratorium</h3>
        <p><strong>Based on the dates and location you provided, there is a moratorium in place for this location. You may not be able to obtain a permit for this location.</strong></p>
        <ul>
          <li>Moratorium details: <strong>{{ data.hidden_moratorium_details }}</strong></li>
          <li>Exception provided: <strong>{{ webform_token('[webform_submission:values:moratorium_choice]', webform_submission) }}</strong></li>
          {% if data.moratorium_appeal_number %}
          <li>Appeal application number: <strong>{{ webform_token('[webform_submission:values:moratorium_appeal_number]', webform_submission) }}</strong></li>
          {% endif %}
        </ul>
        {% if data.moratorium_appeal_description %}
        <p><strong>Appeal description:</strong></p>
        <p>{{ webform_token('[webform_submission:values:moratorium_appeal_description]', webform_submission) }}</p>
        {% endif %}
        {% endif %}
        <h3>Location</h3>
        <ul>
          <li>At the address: <strong>{{ webform_token('[webform_submission:values:report_location:location_address]', webform_submission) }}</strong>{% if location_search %}<em> (you entered: {{ location_search }})</em>{% endif %}</li>
          <li>You will be reserving parking on: <strong>{{ webform_token('[webform_submission:values:7day_permit_street_name]', webform_submission) }}</strong></li>
        </ul>
        <h3>Dates</h3>
        {% if data.permit_date_unenforceable_agree %}
        <p><strong>The start date you selected is sooner than we can typically accommodate. Reserving parking requires placing signage in advance, so we may be unable to meet your requested start date and you may be unable to have any enforcement of your reserved zone.</strong></p>
        {% endif %}
        <ul>
          <li>Days of week: <strong>{{ webform_token('[webform_submission:values:permit_date_days_of_week]', webform_submission) }}</strong></li>
          <li>Start date: <strong>{{ data.permit_date_start|date('D, m/d/Y') }}</strong></li>
          <li>End date: <strong>{{ data.permit_date_end|date('D, m/d/Y') }}</strong></li>
        </ul>
        <h3>Permit details</h3>
        <ul>
          <li>How many 20ft spaces: <strong>{{ webform_token('[webform_submission:values:permit_amount_20ft_spaces]', webform_submission) }}</strong></li>
          <li>Requested use: <strong>{{ data.computed_permit_reason }}</strong></li>
        </ul>
        {{ block('contact_info') }}
        <h3>Acknowledgements</h3>
        <p>As part of submitting this application, you agreed with the conditions of this permit:</p>
        <ul>
          <li>You understand that this permit is NOT valid in Metered Parking Districts.</li>
          <li>You understand that this permit is not valid on streets less than 28 feet wide.</li>
          <li>You understand that this permit is only for moving, utility work, property maintenance, construction, and event loading/unloading.</li>
          <li>You understand that obtaining this permit does not automatically reserve a specific parking space, nor guarantee availability of a space to reserve.</li>
        </ul>
      {% elseif data.permit_type in ["traffic_control", "lt_traffic_control", "fun", "contractor", "bureau", "sidewalk_repair"] %}
        <h2>Your application</h2>
        <p><strong>You Requested:</strong> {{ webform_token('[webform_submission:values:wizard_permit_need]', webform_submission) }}</p>
        {% if data.hidden_moratorium_details %}
        <h3>Moratorium</h3>
        <p><strong>Based on the dates and location you provided, there is a moratorium in place for this location. You may not be able to obtain a permit for this location.</strong></p>
        <ul>
          <li>Moratorium details: <strong>{{ data.hidden_moratorium_details }}</strong></li>
          <li>Exception provided: <strong>{{ webform_token('[webform_submission:values:moratorium_choice]', webform_submission) }}</strong></li>
          {% if data.moratorium_appeal_number %}
          <li>Appeal application number: <strong>{{ webform_token('[webform_submission:values:moratorium_appeal_number]', webform_submission) }}</strong></li>
          {% endif %}
        </ul>
        {% if data.moratorium_appeal_description %}
        <p><strong>Appeal description:</strong></p>
        <p>{{ webform_token('[webform_submission:values:moratorium_appeal_description]', webform_submission) }}</p>
        {% endif %}
        {% endif %}
        <h3>Location</h3>
        <ul>
          <li>At the address: <strong>{{ webform_token('[webform_submission:values:report_location:location_address]', webform_submission) }}</strong>{% if location_search %}<em> (you entered: {{ location_search }})</em>{% endif %}</li>
          <li>Primary street: <strong>{{ webform_token('[webform_submission:values:complex_permit_street_name]', webform_submission) }}</strong></li>
          <li>Side of the street: <strong>{{ webform_token('[webform_submission:values:complex_permit_street_side]', webform_submission) }}</strong></li>
          <li>Between cross street: <strong>{{ webform_token('[webform_submission:values:complex_permit_cross_street_left]', webform_submission) }}</strong></li>
          <li>And cross street: <strong>{{ webform_token('[webform_submission:values:complex_permit_cross_street_right]', webform_submission) }}</strong></li>
          {% if data.hidden_location_busy %}
          <li>Busy: <strong>Yes</strong></li>
          {% endif %}
        </ul>
        <h3>Dates</h3>
        {% if data.permit_date_unenforceable_agree %}
        <p><strong>The start date you selected is sooner than we can typically accommodate, and we may be unable to meet your requested start date. As soon as we are able to process your application, we will let you know the soonest start date we can manage.</strong></p>
        {% endif %}
        <ul>
          <li>Days of week: <strong>{{ webform_token('[webform_submission:values:permit_date_days_of_week]', webform_submission) }}</strong></li>
          <li>Start date: <strong>{{ data.permit_date_start|date('D, m/d/Y') }}</strong></li>
          <li>End date: <strong>{{ data.permit_date_end|date('D, m/d/Y') }}</strong></li>
          <li>Requested Start and End times: <strong>{{ webform_token('[webform_submission:values:complex_permit_requested_times]', webform_submission) }}</strong></li>
        </ul>
        <h3>Permit details</h3>
        <ul>
          {% if data.contact_applicant_type != "sidewalk_repair" %}
          <li>Type of work: <strong>{{ data.computed_permit_reason }}</strong></li>
          {% endif %}
          {% if data.complex_permit_closure_type %}
          <li>Type of closure(s): <strong>{{ webform_token('[webform_submission:values:complex_permit_closure_type]', webform_submission) }}</strong></li>
          <li>Lanes affected: <strong>{{ webform_token('[webform_submission:values:complex_permit_lanes_affected]', webform_submission) ?: '0' }}</strong></li>
          <li>Parking spaces affected: <strong>{{ webform_token('[webform_submission:values:complex_permit_parking_spaces_affected]', webform_submission) ?: '0' }}</strong></li>
          {% endif %}
          {% if data.complex_permit_sidewalk_repair_closure %}<li>Sidewalk closure: <strong>{{ webform_token('[webform_submission:values:complex_permit_sidewalk_repair_closure]', webform_submission) }}</strong></li>{% endif %}
          {% if data.complex_permit_duration_impact %}<li>Expected duration of work / ROW impact: <strong>{{ webform_token('[webform_submission:values:complex_permit_duration_impact]', webform_submission) }}</strong></li>{% endif %}
          {% if data.complex_permit_sidewalk_permit_number %}<li>Sidewalk Repair permit number: <strong>{{ webform_token('[webform_submission:values:complex_permit_sidewalk_permit_number]', webform_submission) }}</strong></li>{% endif %}
          {% if data.complex_permit_job_number %}<li>Job number: <strong>{{ webform_token('[webform_submission:values:complex_permit_job_number]', webform_submission) }}</strong></li>{% endif %}
          {% if data.complex_permit_billing_info %}<li>Billing information: <strong>{{ webform_token('[webform_submission:values:complex_permit_billing_info]', webform_submission) }}</strong></li>{% endif %}
          {% if data.complex_permit_bureau_contact %}<li>Bureau contact: <strong>{{ webform_token('[webform_submission:values:complex_permit_bureau_contact]', webform_submission) }}</strong></li>{% endif %}
          {% if data.computed_bds_permit_number %}<li>Associated BDS permit number: <strong>{{ webform_token('[webform_submission:values:computed_bds_permit_number]', webform_submission) }}</strong></li>{% endif %}
        </ul>
        {% if data.complex_permit_work_description %}
        <p><strong>Work Description:</strong></p>
        <p>{{ webform_token('[webform_submission:values:complex_permit_work_description]', webform_submission) }}</p>
        {% endif %}
        {% if data.complex_permit_additional_info %}
        <p><strong>Additional Info:</strong></p>
        <p>{{ webform_token('[webform_submission:values:complex_permit_additional_info]', webform_submission) }}</p>
        {% endif %}
        {{ block('contact_info') }}
        <h3>Acknowledgements</h3>
        <p>As part of submitting this application, you agreed with the conditions of this permit:</p>
        <ul>
          {% if data.permit_type == "traffic_control" %}
          <li><a href="https://www.portland.gov/transportation/permitting/documents/temporary-street-use-permit-conditions/download" target="_blank">Conditions of a Permit to Use a Dedicated Street Area</a></li>
          {% endif %}
          {% if (data.wizard_permit_need == "parking" or "parking" in data.complex_permit_closure_type) and data.permit_location_metered == "true" %}
          <li><a href="https://www.portland.gov/transportation/permitting/documents/non-metered-parking-reservation-overview/download" target="_blank">Parking Enforcement verification procedure</a></li>
          {% endif %}
          {% if data.complex_permit_acknowledge_supervision %}
          <li>You certify that the person implementing traffic control measures will be under the supervision of a competent person experienced and knowledgeable in safely setting up temporary traffic control devices.</li>
          {% endif %}
          {% if data.complex_permit_acknowlege_insurance %}
          <li><a href="https://www.portland.gov/transportation/permitting/insurance-and-bond-requirements-permits-public-right-way" target="_blank">Your insurance information is on file or is being submitted,</a> naming the City of Portland as additionally insured.</li>
          {% endif %}
          {% if data.complex_permit_acknowledge_trimet %}
          <li>You have notified TriMet if your work is along a transit route.</li>
          {% endif %}
          <li><a href="https://www.portland.gov/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees" target="_blank">Change Fee and Refund Policies</a></li>
        </ul>
      {% elseif data.permit_type == "change_request" %}
        <h2>Your change request</h2>
        <p><strong>You Requested:</strong> {{ webform_token('[webform_submission:values:wizard_existing_permit_situation]', webform_submission) }}</p>
        <h3>Change details</h3>
        <ul>
          <li>Amount of items to change: <strong>{{ webform_token('[webform_submission:values:change_request_items_to_change]', webform_submission) }}</strong></li>
          <li>Identifying Number: <strong>{{ data.change_request_id|default([])|map(id => '#' ~ id)|join(', ') }}</strong></li>
          <li>Location of permit(s): <strong>{{ webform_token('[webform_submission:values:change_request_location]', webform_submission) }}</strong></li>
          <li>Type of change requested: <strong>{{ webform_token('[webform_submission:values:change_request_change_type]', webform_submission) }}</strong></li>
        </ul>
        {% if data.change_request_additional_info %}
        <p><strong>Change details:</strong></p>
        <p>{{ webform_token('[webform_submission:values:change_request_additional_info]', webform_submission) }}</p>
        {% endif %}
        {{ block('contact_info') }}
        <h3>Acknowledgements</h3>
        <p>As part of submitting this request, you agreed with the following conditions:</p>
        <ul>
          <li>You understand that a $30.00 change fee may apply. This fee will not apply if this is your first change to this permit.</li>
        </ul>
      {% elseif data.permit_type == "renewal_request" %}
        <h2>Your renewal request</h2>
        <p><strong>You Requested:</strong> {{ webform_token('[webform_submission:values:wizard_existing_permit_situation]', webform_submission) }}</p>
        <h3>Renewal details</h3>
        <ul>
          <li>Amount of permits to renew: <strong>{{ webform_token('[webform_submission:values:renewal_request_items_to_change]', webform_submission) }}</strong></li>
          <li>Identifying Number: <strong>{{ data.renewal_request_id|default([])|map(id => '#' ~ id)|join(', ') }}</strong></li>
          <li>Location of permit(s): <strong>{{ webform_token('[webform_submission:values:renewal_request_location]', webform_submission) }}</strong></li>
        </ul>
        {% if data.renewal_request_additional_info %}
        <p><strong>Renewal details:</strong></p>
        <p>{{ webform_token('[webform_submission:values:renewal_request_additional_info]', webform_submission) }}</p>
        {% endif %}
        <h3>Dates</h3>
        <ul>
          <li>Days of week: <strong>{{ webform_token('[webform_submission:values:renewal_request_permit_date_days_of_week]', webform_submission) }}</strong></li>
          <li>Start date: <strong>{{ data.renewal_request_permit_date_start|date('D, m/d/Y') }}</strong></li>
          <li>End date: <strong>{{ data.renewal_request_permit_date_end|date('D, m/d/Y') }}</strong></li>
        </ul>
        {{ block('contact_info') }}
        <h3>Acknowledgements</h3>
        <p>As part of submitting this request, you agreed with the following conditions:</p>
        <ul>
          <li><a href="https://www.portland.gov/transportation/permitting/documents/temporary-street-use-permit-conditions/download" target="_blank">Conditions of a Permit to Use a Dedicated Street Area</a></li>
          <li><a href="https://www.portland.gov/transportation/permitting/documents/non-metered-parking-reservation-overview/download" target="_blank">Parking Enforcement verification procedure</a></li>
          <li><a href="https://www.portland.gov/transportation/permitting/temporary-street-use-permitting-tsup#toc-fees" target="_blank">Change Fee and Refund Policies</a></li>
          <li><a href="https://www.portland.gov/transportation/permitting/insurance-and-bond-requirements-permits-public-right-way" target="_blank">Your insurance information is on file or is being submitted,</a> naming the City of Portland as additionally insured.</li>
          <li>You have notified TriMet if your work is along a transit route.</li>
        </ul>
      {% endif %}
  report_ticket_id:
    '#type': hidden
    '#title': 'Report Ticket Id'
  computed_confirmation_message:
    '#type': webform_computed_twig
    '#title': 'Computed confirmation message'
    '#display_on': none
    '#mode': html
    '#template': |-
      {% if data.permit_type == "parking_only" %}
        <p><strong>Your Application Number: </strong>{{ data.report_ticket_id }}</p>
        <p>Thank you for submitting a Temporary Street Use Permit application. We will contact you shortly with the price and next steps.</p>
        <p>If you have not heard back from us about this submission within 5 business days, please first check your SPAM folder, and then contact us at <a href="mailto:TSUP@portlandoregon.gov">TSUP@portlandoregon.gov</a> or <a href="tel:+1-503-823-7365">503-823-7365</a>.</p>
        <p>To cancel or make a change to this request, please <a href="{{ webform_token('[webform:url]', webform_submission) }}?assessment_prefilled=1&wizard_permit_need=existing_permit&wizard_existing_permit_situation=change&change_request_id[]={{ data.report_ticket_id }}">submit a Change Request here.</a></p>
      {% elseif data.permit_type == "7day" %}
        <p><strong>Your Application Number: </strong>{{ data.report_ticket_id }}</p>
        <p><a class="btn btn-primary" href="https://www.portlandoregon.gov/transportation/prpinvoice/?action=process&appnum={{ data.report_ticket_id }}&spaces={{ data.permit_amount_20ft_spaces }}&fieldnames=">PAY TO ACTIVATE YOUR PERMIT</a></p>
        <p>Your application for a Temporary Street Use Permit has been received. <strong>Please click the button above to pay and activate your permit.</strong> Once the invoice has been paid, you will be able to access the PERMIT ID CARD and NO PARKING SIGNS.</p>
        <p>If you have any questions, please contact us at <a href="mailto:TSUP@portlandoregon.gov">TSUP@portlandoregon.gov</a> or <a href="tel:+1-503-823-7365">503-823-7365</a>.</p>
      {% elseif data.permit_type == "traffic_control" or data.permit_type == "lt_traffic_control" %}
        <p><strong>Your Application Number: </strong>{{ data.report_ticket_id }}</p>
        <p>Thank you for submitting a Temporary Street Use Permit application. We will contact you shortly with a price and payment date. If the application is incomplete, you will be contacted for additional information.</p>
        <p>If you are impacting a Sidewalk or Lane and your work is along a TriMet transit route, you are required to notify them at least five business days in advance of your work. Email TriMet at <a href="mailto:foc@trimet.org">foc@trimet.org</a> or call them at <a href="tel:+1-503-962-4949">503-962-4949</a>.</p>
        <p><strong>Due to processing times and parking enforcement logistics, your permit may not be valid for up to 15 business days. If the application is incomplete, you will be contacted for additional information.</strong></p>
        <p>If you have not heard back from us about this submission within 5 business days, please first check your SPAM folder, and then contact us at <a href="mailto:TSUP@portlandoregon.gov">TSUP@portlandoregon.gov</a> or <a href="tel:+1-503-823-7365">503-823-7365</a>.</p>
        <p>To cancel or make a change to this request, please <a href="{{ webform_token('[webform:url]', webform_submission) }}?assessment_prefilled=1&wizard_permit_need=existing_permit&wizard_existing_permit_situation=change&change_request_id[]={{ data.report_ticket_id }}">submit a Change Request here.</a></p>
      {% elseif data.permit_type == "change_request" %}
        <p><strong>Your Change Request Number: </strong>{{ data.report_ticket_id }}</p>
        <p>Thank you for submitting a Change Request. We will do our best to accommodate your request. A member of our staff should respond to your request within 2 business days.</p>
        <p>To make a change to this request, please submit another Change Request form.</p>
        <p>If you have not heard back from us about this submission within 2 business days, please first check your SPAM folder, and then contact us at <a href="mailto:TSUP@portlandoregon.gov">TSUP@portlandoregon.gov</a> or <a href="tel:+1-503-823-7365">503-823-7365</a>.</p>
      {% elseif data.permit_type == "renewal_request" %}
        <p><strong>Your Renewal Request Number: </strong>{{ data.report_ticket_id }}</p>
        <p>Thank you for submitting a Renewal Request. We will contact you shortly with the price and next steps.</p>
        <p>If you are impacting a Sidewalk or Lane and your work is along a TriMet transit route, you are required to notify them at least five business days in advance of your work. Email TriMet at <a href="mailto:foc@trimet.org">foc@trimet.org</a> or call them at <a href="tel:+1-503-962-4949">503-962-4949</a>.</p>
        <p>To cancel or make changes to your application, please submit a Change Request form. We will do our best to accommodate your change request.</p>
        <p>If you have not heard back from us about this submission within 5 business days, please first check your SPAM folder, and then contact us at <a href="mailto:TSUP@portlandoregon.gov">TSUP@portlandoregon.gov</a> or <a href="tel:+1-503-823-7365">503-823-7365</a>.</p>
      {% endif %}
  assessment_prefilled:
    '#type': hidden
    '#title': 'Assessment Prefilled (skips first page)'
    '#prepopulate': true
css: ''
javascript: "(function ($, Drupal) {\r\n  const resetMoratoriumData = (features) => {\r\n    const dataEl = document.querySelector(\r\n      \"input[name='hidden_moratorium_data']\"\r\n    );\r\n    if (!dataEl) return;\r\n\r\n    dataEl.value = \"[]\";\r\n  };\r\n\r\n  const appendMoratoriumData = (features) => {\r\n    const dataEl = document.querySelector(\r\n      \"input[name='hidden_moratorium_data']\"\r\n    );\r\n    if (!dataEl) return;\r\n\r\n    const moratoriumData = JSON.parse(dataEl.value || \"[]\");\r\n    moratoriumData.push(...features);\r\n    dataEl.value = JSON.stringify(moratoriumData);\r\n  };\r\n\r\n  const resetBusyValue = (val) => {\r\n    const busyEl = document.querySelector(\"input[name='hidden_location_busy']\");\r\n    if (!busyEl) return;\r\n\r\n    busyEl.value = \"\";\r\n  };\r\n\r\n  const appendBusyIfData = (name, features) => {\r\n    const busyEl = document.querySelector(\"input[name='hidden_location_busy']\");\r\n    if (!busyEl) return;\r\n\r\n    if (features.length > 0)\r\n      busyEl.value = busyEl.value\r\n        .split(\",\")\r\n        .filter(Boolean)\r\n        .concat(name)\r\n        .join(\",\");\r\n  };\r\n\r\n  Drupal.behaviors.tsupLayerCheck = {\r\n    FEATURE_LAYERS: {\r\n      holidayMoratoriums: {\r\n        url: \"https://www.portlandmaps.com/arcgis/rest/services/Public/PBOT_Permitting/MapServer/3/query\",\r\n        query: {\r\n          where: \"1=1\",\r\n          spatialRel: \"esriSpatialRelIntersects\",\r\n          distance: 50,\r\n          units: \"esriSRUnit_Foot\",\r\n          outFields: \"*\",\r\n        },\r\n        handler: appendMoratoriumData,\r\n      },\r\n      roseFestivalMoratoriums: {\r\n        url: \"https://www.portlandmaps.com/arcgis/rest/services/Public/PBOT_Permitting/MapServer/4/query\",\r\n        query: {\r\n          where: \"1=1\",\r\n          spatialRel: \"esriSpatialRelIntersects\",\r\n          distance: 50,\r\n          units: \"esriSRUnit_Foot\",\r\n          outFields: \"*\",\r\n        },\r\n        handler: appendMoratoriumData,\r\n      },\r\n      busLines: {\r\n        url: \"https://www.portlandmaps.com/arcgis/rest/services/Public/Transit/MapServer/8/query\",\r\n        query: {\r\n          where: \"1=1\",\r\n          spatialRel: \"esriSpatialRelIntersects\",\r\n          distance: 50,\r\n          units: \"esriSRUnit_Foot\",\r\n          outFields: \"ROUTE\",\r\n        },\r\n        handler: appendBusyIfData.bind(this, \"busLines\"),\r\n      },\r\n      trafficSignals: {\r\n        url: \"https://www.portlandmaps.com/arcgis/rest/services/Public/PBOT_Assets/MapServer/199/query\",\r\n        query: {\r\n          where: \"1=1\",\r\n          spatialRel: \"esriSpatialRelIntersects\",\r\n          distance: 250,\r\n          units: \"esriSRUnit_Foot\",\r\n        },\r\n        handler: appendBusyIfData.bind(this, \"trafficSignals\"),\r\n      },\r\n      lineMarkings: {\r\n        url: \"https://www.portlandmaps.com/arcgis/rest/services/Public/Transportation/MapServer/65/query\",\r\n        query: {\r\n          // MLCenterlineST, MLTrafficLaneST, MLTurnLaneST\r\n          where: \"LineType IN (3611, 3612, 3616)\",\r\n          spatialRel: \"esriSpatialRelIntersects\",\r\n          distance: 50,\r\n          units: \"esriSRUnit_Foot\",\r\n          resultRecordCount: 1,\r\n        },\r\n        handler: appendBusyIfData.bind(this, \"lineMarkings\"),\r\n      },\r\n    },\r\n\r\n    attach(context) {\r\n      once(\r\n        \"tsupLayerCheck\",\r\n        \"[data-drupal-selector='edit-report-location']\",\r\n        context\r\n      ).forEach((el) => {\r\n        el.addEventListener(\"location-picked\", () => {\r\n          resetMoratoriumData();\r\n          resetBusyValue();\r\n\r\n          const x = document.querySelector(\"#location_x\").value;\r\n          const y = document.querySelector(\"#location_y\").value;\r\n          for (const [key, { url, query }] of Object.entries(\r\n            this.FEATURE_LAYERS\r\n          )) {\r\n            fetch(\r\n              `${url}?${new URLSearchParams({\r\n                ...query,\r\n                geometry: `${x},${y}`,\r\n                geometryType: \"esriGeometryPoint\",\r\n                returnGeometry: false,\r\n                f: \"geojson\",\r\n              })}`\r\n            )\r\n              .then((res) => res.json())\r\n              .then(({ features }) =>\r\n                this.FEATURE_LAYERS[key].handler(features)\r\n              );\r\n          }\r\n        });\r\n      });\r\n    },\r\n  };\r\n\r\n  Drupal.behaviors.tsupDateCalculator = {\r\n    FRIENDLY_MORATORIUM_CATEGORIES: {\r\n      HOLIDAY: \"Holiday\",\r\n      ROSEFESTIVAL: \"Rose Festival\",\r\n    },\r\n    FRIENDLY_MORATORIUM_RESTRICTION_TYPES: {\r\n      \"TRAVEL-SIDEWALK\": \"travel lanes and sidewalks\",\r\n      \"PARK-TRAVEL-SIDEWALK\": \"parking, travel lanes, and sidewalks\",\r\n    },\r\n\r\n    attach(context) {\r\n      const isDateSame = (a, b) =>\r\n        a.getFullYear() === b.getFullYear() &&\r\n        a.getMonth() === b.getMonth() &&\r\n        a.getDate() === b.getDate();\r\n      const dayNameToNum = {\r\n        sunday: 0,\r\n        monday: 1,\r\n        tuesday: 2,\r\n        wednesday: 3,\r\n        thursday: 4,\r\n        friday: 5,\r\n        saturday: 6,\r\n      };\r\n\r\n      const setDateSpan = (amtDays) => {\r\n        $(\"input[name='permit_date_span']\").val(amtDays);\r\n        $(\"input[name='permit_date_span']\").trigger(\"change\");\r\n      };\r\n\r\n      const getEarliestStartDate = () => {\r\n        const permitType = $(\"input[name='permit_type']\").val();\r\n        const isMetered =\r\n          $(\"input[name='permit_location_metered']\").val() === \"true\";\r\n\r\n        const startDateOffsetDays = permitType.includes(\"traffic_control\")\r\n          ? 12\r\n          : isMetered\r\n          ? 3\r\n          : 4;\r\n        const earliestStartDate = new Date();\r\n        earliestStartDate.setDate(\r\n          earliestStartDate.getDate() + startDateOffsetDays\r\n        );\r\n        earliestStartDate.setHours(0);\r\n        earliestStartDate.setMinutes(0);\r\n        earliestStartDate.setSeconds(0);\r\n        earliestStartDate.setMilliseconds(0);\r\n\r\n        return earliestStartDate;\r\n      };\r\n\r\n      const calculateDateSpan = () => {\r\n        const moratoriumFeatures = JSON.parse(\r\n          $(\"input[name='hidden_moratorium_data']\").val() || \"[]\"\r\n        );\r\n        const isMetered =\r\n          $(\"input[name='permit_location_metered']\").val() === \"true\";\r\n        const permitType = $(\"input[name='permit_type']\").val();\r\n\r\n        const daysOfWeek =\r\n          $(\"input[name*='permit_date_days_of_week']\")\r\n            .filter(\":checked\")\r\n            .map((_, el) => dayNameToNum[el.value])\r\n            .get() || [];\r\n        const startValue = $(\"input[name='permit_date_start']\").val();\r\n        const endValue = $(\"input[name='permit_date_end']\").val();\r\n        if (!startValue || !endValue) return;\r\n        $(\".date-calculator\").html(\"\");\r\n        $(\".date-error\").text(\"\");\r\n\r\n        const startDate = new Date(startValue + \"T00:00\");\r\n        const endDate = new Date(endValue + \"T00:00\");\r\n        if (\r\n          isNaN(startDate.getTime()) ||\r\n          isNaN(endDate.getTime()) ||\r\n          startDate.getTime() > endDate.getTime()\r\n        ) {\r\n          $(\".date-error\").text(\r\n            \"Your start date cannot be later than your end date.\"\r\n          );\r\n          setDateSpan(0);\r\n          return;\r\n        }\r\n\r\n        if (daysOfWeek.length === 0) {\r\n          $(\".date-error\").text(\r\n            \"You must select the days of the week you'd like your permit to be active.\"\r\n          );\r\n          setDateSpan(0);\r\n          return;\r\n        }\r\n\r\n        // if start date is too early, mark as unenforceable\r\n        $(\"input[name='permit_date_unenforceable']\")\r\n          .val(startDate.getTime() < getEarliestStartDate().getTime())\r\n          .trigger(\"change\");\r\n\r\n        let amtDays = 0;\r\n        // non-metered billing is calculated by the raw date range,\r\n        // regardless of any days of the week selected. only restrict days if metered\r\n        if (!isMetered || daysOfWeek.includes(startDate.getDay())) amtDays++;\r\n\r\n        const curDate = new Date(startValue + \"T00:00\");\r\n        const daysOfWeekFound = {};\r\n        // check the start date and mark if we found the day of the week, as the while loop below will\r\n        // skip the first day.\r\n        const startDay = startDate.getDay();\r\n        if (daysOfWeek.includes(startDay)) daysOfWeekFound[startDay] = true;\r\n\r\n        while (!isDateSame(curDate, endDate)) {\r\n          curDate.setDate(curDate.getDate() + 1);\r\n\r\n          const day = curDate.getDay();\r\n          // reference comment above -- non-metered ignores days of week selected\r\n          if (!isMetered || daysOfWeek.includes(day)) {\r\n            amtDays++;\r\n            daysOfWeekFound[day] = true;\r\n          }\r\n        }\r\n\r\n        setDateSpan(amtDays);\r\n\r\n        if (amtDays === 0 || !daysOfWeek.every((day) => daysOfWeekFound[day])) {\r\n          $(\".date-error\").text(\r\n            \"The time period you selected does not contain all of the days of the week you selected.\"\r\n          );\r\n          setDateSpan(0);\r\n          return;\r\n        }\r\n        \r\n        const amtWeeks = Math.ceil(amtDays / 7);\r\n        // max range is 28 days for fun/contractor/bureau/sidewalk_repair, else 26 weeks.\r\n        if (permitType === \"fun\" || permitType === \"contractor\" || permitType === \"bureau\" || permitType === \"sidewalk_repair\") {\r\n          if (amtDays > 28) {\r\n            $(\".date-error\").text(\r\n              \"The maximum date selection for your permit is 28 days. Please reduce your date range.\"\r\n            );\r\n            setDateSpan(0);\r\n            return;\r\n          }\r\n        } else {\r\n          if (amtWeeks > 26) {\r\n            $(\".date-error\").text(\r\n              \"The maximum date selection for your permit is 26 weeks. Please reduce your date range.\"\r\n            );\r\n            setDateSpan(0);\r\n            return;\r\n          }\r\n        }\r\n        \r\n        let foundMoratorium = moratoriumFeatures.find(\r\n          (f) =>\r\n            startDate.getTime() <= f.properties.MoratoriumEndDate &&\r\n            endDate.getTime() >= f.properties.MoratoriumStartDate\r\n        );\r\n        const moratoriumChoice = $(\r\n          \"input[name=moratorium_choice]:checked\"\r\n        ).val();\r\n        // If the user has selected a moratorium exception other than changing the dates, we bypass the moratorium check.\r\n        const bypassMoratoriumCheck =\r\n          moratoriumChoice && moratoriumChoice !== \"change_dates\";\r\n        if (foundMoratorium) {\r\n          const category = foundMoratorium.properties.MoratoriumCategory;\r\n          const restrictionType =\r\n            foundMoratorium.properties.MoratoriumRestrictionType;\r\n          // Travel-Sidewalk is not applicable to parking-only permits.\r\n          const isApplicable =\r\n            restrictionType === \"TRAVEL-SIDEWALK\"\r\n              ? permitType !== \"parking_only\"\r\n              : true;\r\n          if (isApplicable && !bypassMoratoriumCheck) {\r\n            const friendlyCategory =\r\n              this.FRIENDLY_MORATORIUM_CATEGORIES[category] || category;\r\n            const friendlyRestrictionType =\r\n              this.FRIENDLY_MORATORIUM_RESTRICTION_TYPES[restrictionType] ||\r\n              restrictionType;\r\n            const friendlyDates = `${new Date(\r\n              foundMoratorium.properties.MoratoriumStartDate\r\n            ).toLocaleDateString()} to ${new Date(\r\n              foundMoratorium.properties.MoratoriumEndDate\r\n            ).toLocaleDateString()}`;\r\n            $(\".moratorium-category\").text(friendlyCategory);\r\n            $(\".moratorium-restriction-type\").text(friendlyRestrictionType);\r\n            $(\".moratorium-dates\").text(friendlyDates);\r\n            $(\"input[name='hidden_moratorium_details']\")\r\n              .val(\r\n                `${friendlyCategory}, ${friendlyDates} (${friendlyRestrictionType})`\r\n              )\r\n              .trigger(\"change\");\r\n            setDateSpan(0);\r\n\r\n            // Hide \"I am moving\" option if permit type is not parking-only\r\n            $(\"input[name=moratorium_choice][value=moving]\")\r\n              .parent()\r\n              .css(\"display\", permitType === \"parking_only\" ? \"\" : \"none\");\r\n\r\n            return;\r\n          } else {\r\n            $(\"input[name='hidden_moratorium_details']\")\r\n              .val(\"\")\r\n              .trigger(\"change\");\r\n          }\r\n        } else {\r\n          $(\"input[name='hidden_moratorium_details']\")\r\n              .val(\"\")\r\n              .trigger(\"change\");\r\n        }\r\n\r\n        if (isMetered) {\r\n          $(\".date-calculator\").html(\r\n            `You've requested <strong>${\r\n              amtDays === 1 ? \"1 day\" : `${amtDays} days`\r\n            }</strong> of closure.`\r\n          );\r\n        } else if (amtDays > 7) {\r\n          // we only show weeks date range if >1 week\r\n          $(\".date-calculator\").html(\r\n            `The date range you have selected spans <strong>${amtWeeks} weeks</strong>. The fees in this area are calculated on a weekly basis.`\r\n          );\r\n        }\r\n      };\r\n\r\n      once(\r\n        \"tsupDateCalculator\",\r\n        \"input[name='permit_date_start']\",\r\n        context\r\n      ).forEach(() => {\r\n        $(\r\n          \"input[name='permit_date_start'], input[name='permit_date_end'], input[name*='permit_date_days_of_week'], input[name='moratorium_choice']\"\r\n        ).change(calculateDateSpan);\r\n        calculateDateSpan();\r\n\r\n        const earliestStartDate = getEarliestStartDate();\r\n        $(\".earliest-start-date\").text(earliestStartDate.toLocaleDateString());\r\n      });\r\n    },\r\n  };\r\n})(jQuery, Drupal);\r\n"
settings:
  ajax: true
  ajax_scroll_top: form
  ajax_progress_type: ''
  ajax_effect: none
  ajax_speed: 0
  page: true
  page_submit_path: ''
  page_confirm_path: ''
  page_theme_name: ''
  form_title: source_entity_webform
  form_submit_once: false
  form_open_message: ''
  form_close_message: ''
  form_exception_message: ''
  form_previous_submissions: true
  form_confidential: false
  form_confidential_message: ''
  form_disable_remote_addr: false
  form_convert_anonymous: false
  form_prepopulate: false
  form_prepopulate_source_entity: false
  form_prepopulate_source_entity_required: false
  form_prepopulate_source_entity_type: ''
  form_unsaved: true
  form_disable_back: false
  form_submit_back: true
  form_disable_autocomplete: false
  form_novalidate: false
  form_disable_inline_errors: false
  form_required: false
  form_autofocus: false
  form_details_toggle: false
  form_reset: true
  form_access_denied: default
  form_access_denied_title: ''
  form_access_denied_message: ''
  form_access_denied_attributes: {  }
  form_file_limit: ''
  form_attributes: {  }
  form_method: ''
  form_action: ''
  share: false
  share_node: false
  share_theme_name: ''
  share_title: true
  share_page_body_attributes: {  }
  submission_label: ''
  submission_exception_message: ''
  submission_locked_message: ''
  submission_log: false
  submission_excluded_elements: {  }
  submission_exclude_empty: false
  submission_exclude_empty_checkbox: false
  submission_views: {  }
  submission_views_replace: {  }
  submission_user_columns: {  }
  submission_user_duplicate: false
  submission_access_denied: default
  submission_access_denied_title: ''
  submission_access_denied_message: ''
  submission_access_denied_attributes: {  }
  previous_submission_message: ''
  previous_submissions_message: ''
  autofill: false
  autofill_message: ''
  autofill_excluded_elements: {  }
  wizard_progress_bar: true
  wizard_progress_pages: false
  wizard_progress_percentage: false
  wizard_progress_link: true
  wizard_progress_states: true
  wizard_start_label: Assessment
  wizard_preview_link: false
  wizard_confirmation: true
  wizard_confirmation_label: Done
  wizard_auto_forward: true
  wizard_auto_forward_hide_next_button: false
  wizard_keyboard: true
  wizard_track: name
  wizard_prev_button_label: ''
  wizard_next_button_label: ''
  wizard_toggle: true
  wizard_toggle_show_label: ''
  wizard_toggle_hide_label: ''
  wizard_page_type: container
  wizard_page_title_tag: h2
  preview: 0
  preview_label: ''
  preview_title: ''
  preview_message: ''
  preview_attributes: {  }
  preview_excluded_elements: {  }
  preview_exclude_empty: true
  preview_exclude_empty_checkbox: false
  draft: none
  draft_multiple: false
  draft_auto_save: false
  draft_saved_message: ''
  draft_loaded_message: ''
  draft_pending_single_message: ''
  draft_pending_multiple_message: ''
  confirmation_type: page
  confirmation_url: ''
  confirmation_title: ''
  confirmation_message: '[webform_submission:values:computed_confirmation_message:raw] [webform_submission:values:computed_ticket_description:raw]'
  confirmation_attributes: {  }
  confirmation_back: true
  confirmation_back_label: 'Submit another application'
  confirmation_back_attributes: {  }
  confirmation_exclude_query: false
  confirmation_exclude_token: false
  confirmation_update: false
  limit_total: null
  limit_total_interval: null
  limit_total_message: ''
  limit_total_unique: false
  limit_user: null
  limit_user_interval: null
  limit_user_message: ''
  limit_user_unique: false
  entity_limit_total: null
  entity_limit_total_interval: null
  entity_limit_user: null
  entity_limit_user_interval: null
  purge: all
  purge_days: 14
  results_disabled: false
  results_disabled_ignore: false
  results_customize: false
  token_view: false
  token_update: false
  token_delete: false
  serial_disabled: false
access:
  create:
    roles:
      - anonymous
      - authenticated
    users: {  }
    permissions: {  }
  view_any:
    roles: {  }
    users: {  }
    permissions: {  }
  update_any:
    roles: {  }
    users: {  }
    permissions: {  }
  delete_any:
    roles: {  }
    users: {  }
    permissions: {  }
  purge_any:
    roles: {  }
    users: {  }
    permissions: {  }
  view_own:
    roles: {  }
    users: {  }
    permissions: {  }
  update_own:
    roles: {  }
    users: {  }
    permissions: {  }
  delete_own:
    roles: {  }
    users: {  }
    permissions: {  }
  administer:
    roles: {  }
    users: {  }
    permissions: {  }
  test:
    roles: {  }
    users: {  }
    permissions: {  }
  configuration:
    roles: {  }
    users: {  }
    permissions: {  }
handlers:
  create_new_zendesk_request:
    id: zendesk
    handler_id: create_new_zendesk_request
    label: 'Create new Zendesk request'
    notes: ''
    status: true
    conditions:
      disabled:
        -
          ':input[name="wizard_permit_need"]':
            value: general
        - or
        -
          ':input[name="support_agent_use_only[test_submission]"]':
            checked: true
    weight: 0
    settings:
      requester_name: contact_full_legal_name
      requester_email: contact_email
      subject: 'Temporary Street Use Permit Application ([webform_submission:values:friendly_permit_type])'
      comment: '[webform_submission:values:computed_ticket_description:raw]'
      tags: 'drupal webform tsup [webform_submission:values:computed_tags]'
      priority: normal
      status: new
      group_id: '12281750992407'
      assignee_id: ''
      type: incident
      collaborators: ''
      custom_fields: "6353388345367: 'apply_tsup'\r\n1500013095781: '[webform_submission:uuid]'\r\n12281632679959: ['12281632679959_[webform_submission:values:permit_type]', 'permit_type']\r\n1900004448785: ['[webform_submission:values:contact_company]', 'contact_company']\r\n12280609857559: ['[webform_submission:values:computed_bds_permit_number]', 'computed_bds_permit_number']\r\n12281140173719: ['[webform_submission:values:computed_num_spaces]', 'computed_num_spaces']\r\n12280733221015: ['[webform_submission:values:computed_date_start]', 'computed_date_start']\r\n12280737894935: ['[webform_submission:values:computed_date_end]', 'computed_date_end']\r\n5581480390679: ['[webform_submission:values:report_location:location_lat]', 'report_location:location_lat']\r\n5581490332439: ['[webform_submission:values:report_location:location_lon]', 'report_location:location_lon']\r\n13407901552407: ['[webform_submission:values:report_location:location_x]', 'report_location:location_x']\r\n13407918835095: ['[webform_submission:values:report_location:location_y]', 'report_location:location_y']\r\n1500012743961: ['[webform_submission:values:report_location:location_address]', 'report_location:location_address']\r\n9205221816983: ['[webform_submission:values:report_location:location_type:raw]', 'report_location:location_type']\r\n12281548831383: ['[webform_submission:values:complex_permit_closure_type]', 'complex_permit_closure_type']\r\n14564469123095: ['[webform_submission:values:permit_location_metered]', 'permit_location_metered']\r\n22195736298263: '[webform_submission:values:computed_permit_reason]'\r\n22195822294935: '[webform_submission:values:computed_permit_street_name]'\r\n29548818770327: ['[webform_submission:values:contact_bureau]', 'contact_bureau']\r\n29548879671575: ['[webform_submission:values:contact_fun_company]', 'contact_fun_company']"
      ticket_id_field: report_ticket_id
      ticket_form_id: '12280613877783'
      recipient: tsup@portlandoregon.gov
      ticket_fork_field: ''
  create_new_zendesk_request_developer_test:
    id: zendesk
    handler_id: create_new_zendesk_request_developer_test
    label: 'Create new Zendesk request - developer test'
    notes: ''
    status: true
    conditions:
      enabled:
        ':input[name="wizard_permit_need"]':
          '!value': general
        ':input[name="support_agent_use_only[test_submission]"]':
          checked: true
    weight: 1
    settings:
      requester_name: contact_full_legal_name
      requester_email: contact_email
      subject: 'Temporary Street Use Permit Application ([webform_submission:values:friendly_permit_type])'
      comment: '[webform_submission:values:computed_ticket_description:raw]'
      tags: 'drupal webform tsup [webform_submission:values:computed_tags]'
      priority: normal
      status: new
      group_id: '4549352062487'
      assignee_id: ''
      type: incident
      collaborators: ''
      custom_fields: "6353388345367: 'apply_tsup'\r\n1500013095781: '[webform_submission:uuid]'\r\n12281632679959: ['12281632679959_[webform_submission:values:permit_type]', 'permit_type']\r\n1900004448785: ['[webform_submission:values:contact_company]', 'contact_company']\r\n12280609857559: ['[webform_submission:values:computed_bds_permit_number]', 'computed_bds_permit_number']\r\n12281140173719: ['[webform_submission:values:computed_num_spaces]', 'computed_num_spaces']\r\n12280733221015: ['[webform_submission:values:computed_date_start]', 'computed_date_start']\r\n12280737894935: ['[webform_submission:values:computed_date_end]', 'computed_date_end']\r\n5581480390679: ['[webform_submission:values:report_location:location_lat]', 'report_location:location_lat']\r\n5581490332439: ['[webform_submission:values:report_location:location_lon]', 'report_location:location_lon']\r\n13407901552407: ['[webform_submission:values:report_location:location_x]', 'report_location:location_x']\r\n13407918835095: ['[webform_submission:values:report_location:location_y]', 'report_location:location_y']\r\n1500012743961: ['[webform_submission:values:report_location:location_address]', 'report_location:location_address']\r\n9205221816983: ['[webform_submission:values:report_location:location_type:raw]', 'report_location:location_type']\r\n12281548831383: ['[webform_submission:values:complex_permit_closure_type]', 'complex_permit_closure_type']\r\n14564469123095: ['[webform_submission:values:permit_location_metered]', 'permit_location_metered']\r\n22195736298263: '[webform_submission:values:computed_permit_reason]'\r\n22195822294935: '[webform_submission:values:computed_permit_street_name]'\r\n29548818770327: ['[webform_submission:values:contact_bureau]', 'contact_bureau']\r\n29548879671575: ['[webform_submission:values:contact_fun_company]', 'contact_fun_company']"
      ticket_id_field: report_ticket_id
      ticket_form_id: '4990038807319'
      recipient: tsup@portlandoregon.gov
      ticket_fork_field: ''
  zendesk_general:
    id: zendesk
    handler_id: zendesk_general
    label: 'Create new Zendesk request - General Comment/Question'
    notes: ''
    status: true
    conditions:
      disabled:
        -
          ':input[name="wizard_permit_need"]':
            '!value': general
        - or
        -
          ':input[name="support_agent_use_only[test_submission]"]':
            checked: true
    weight: 2
    settings:
      requester_name: ''
      requester_email: general_email
      subject: 'General permit question'
      comment: "<p><strong>Details:</strong></p>\r\n<p>[webform_submission:values:general_comment_details]</p>\r\n<p><strong>Permit Number:</strong> [webform_submission:values:general_permit_number]</p>"
      tags: 'drupal webform tsup'
      priority: normal
      status: new
      group_id: '12281750992407'
      assignee_id: ''
      type: question
      collaborators: ''
      custom_fields: "6353388345367: 'apply_tsup'\r\n1500013095781: '[webform_submission:uuid]'\r\n"
      ticket_id_field: report_ticket_id
      ticket_form_id: '9791802547607'
      recipient: tsup@portlandoregon.gov
      ticket_fork_field: ''
  zendesk_general_dev:
    id: zendesk
    handler_id: zendesk_general_dev
    label: 'Create new Zendesk request - General Comment/Question - Developer Test'
    notes: ''
    status: true
    conditions:
      enabled:
        ':input[name="wizard_permit_need"]':
          value: general
        ':input[name="support_agent_use_only[test_submission]"]':
          checked: true
    weight: 3
    settings:
      requester_name: ''
      requester_email: general_email
      subject: 'General permit question'
      comment: "<p><strong>Details:</strong></p>\r\n<p>[webform_submission:values:general_comment_details]</p>\r\n<p><strong>Permit Number:</strong> [webform_submission:values:general_permit_number]</p>"
      tags: 'drupal webform tsup'
      priority: normal
      status: new
      group_id: '4549352062487'
      assignee_id: ''
      type: question
      collaborators: ''
      custom_fields: "6353388345367: 'apply_tsup'\r\n1500013095781: '[webform_submission:uuid]'\r\n"
      ticket_id_field: report_ticket_id
      ticket_form_id: '9791802547607'
      recipient: tsup@portlandoregon.gov
      ticket_fork_field: ''
variants: {  }
